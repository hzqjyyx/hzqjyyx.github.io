<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="language,java,book," />


<meta name="description" content="Basic Idea In this article, I will try to summarize a whole picture of java world. The knowledge is drawn from 《Effective Java 3rd》《Think in Java》《Java 8 in Action》.">
<meta name="keywords" content="language,java,book">
<meta property="og:type" content="article">
<meta property="og:title" content="Understanding Java">
<meta property="og:url" content="https://hzqjyyx.github.io/2018/09/Understanding-Java/index.html">
<meta property="og:site_name" content="泽强的工作台">
<meta property="og:description" content="Basic Idea In this article, I will try to summarize a whole picture of java world. The knowledge is drawn from 《Effective Java 3rd》《Think in Java》《Java 8 in Action》.">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2eakesoj20ug0emwfh.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2eihuyfj20vu0uomy0.jpg">
<meta property="og:image" content="https://pic4.zhimg.com/80/d643d9ab5c933ac475cfa23063bed137_hd.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2eq4llmj20re0oyq56.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2fb3njkj20sc0fqdh5.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2ewl7qwj20tn0j3405.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2f2ng9zj20s20c0my5.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2fvo4ffj20qi0lrdgx.jpg">
<meta property="og:image" content="http://o9bjjf9jh.bkt.clouddn.com/blog/180903/H9451f09ci.png?imageslim">
<meta property="og:image" content="http://o9bjjf9jh.bkt.clouddn.com/blog/180903/KH50deggfC.png?imageslim">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2g2vjwmj20y30jpgm6.jpg">
<meta property="og:updated_time" content="2019-01-11T01:26:04.453Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Understanding Java">
<meta name="twitter:description" content="Basic Idea In this article, I will try to summarize a whole picture of java world. The knowledge is drawn from 《Effective Java 3rd》《Think in Java》《Java 8 in Action》.">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/df637165ly1fwy2eakesoj20ug0emwfh.jpg">






  <link rel="canonical" href="https://hzqjyyx.github.io/2018/09/Understanding-Java/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>Understanding Java | 泽强的工作台</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">泽强的工作台</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">笔记/科研</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            Home</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            About</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            Tags</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            Categories</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            Archives</a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            Search</a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hzqjyyx.github.io/2018/09/Understanding-Java/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="黄泽强（Zeqiang Huang)">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="泽强的工作台">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Understanding Java</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-09-02T18:24:00-07:00">2018-09-02</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/language/" itemprop="url" rel="index"><span itemprop="name">language</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/09/Understanding-Java/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/09/Understanding-Java/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article&#58;</span>
                
                <span title="Symbols count in article"></span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="basic-idea"><a class="markdownIt-Anchor" href="#basic-idea"></a> Basic Idea</h1>
<p>In this article, I will try to summarize a whole picture of java world. The knowledge is drawn from 《Effective Java 3rd》《Think in Java》《Java 8 in Action》.</p>
<a id="more"></a>
<h1 id="general-understanding"><a class="markdownIt-Anchor" href="#general-understanding"></a> General Understanding</h1>
<p>Essential feature of an object-oriented programming language: inheritance, data abstraction and polymorphism.</p>
<p>Inheritance give us the ability to link objects to a tree-like structure, which can provide <u>is-a</u> relationship.</p>
<p>Data abstraction can hide implementation detail and organize state and operation together. Implementation hiding separates the interface from the implementation by making the details <strong>private</strong>.</p>
<p>Abstraction hides complexity by giving you a more abstract picture, a sort of 10,000 feet view, while Encapsulation hides internal working so that you can change it later. In other words, Abstraction hides details at the <strong>design</strong> level, while Encapsulation hides details at the <strong>implementation</strong> level.</p>
<p><strong>Polymorphism</strong> is the term of a single interface to entities of different type or the use of a single symbol to represent multiple different types. Polymorphism allows improved code organization and readability as well as the creation of extensible programs that can be “<strong>grown</strong>” not only during the original creation of the project, but also when new features are desired.</p>
<ul>
<li>ad hoc polymorphism: different behavior of when type is different: ‘+’: int/double/string</li>
<li>parametric polymorphism: a function or a data type to be written generically.</li>
<li>subtyping: powered by inheritance.</li>
</ul>
<p><strong>Early binding(static polymorphism) VS Late binding(dynamic polymorphism):</strong></p>
<p>Early binding happens at compiler time, it is fast, can be optimized by compiler.<br>
Late binding happens at runtime, it is slow, need to check a table to determine which version of method to call.</p>
<p><strong>Method overloading</strong> is an example of static polymorphism, while <strong>method overriding</strong> is an example of dynamic polymorphism.</p>
<p><strong>Duck type</strong>: if an object behaves like a duck, it is a duck.</p>
<h2 id="data-type"><a class="markdownIt-Anchor" href="#data-type"></a> Data Type</h2>
<h3 id="primitive"><a class="markdownIt-Anchor" href="#primitive"></a> Primitive</h3>
<p>Java determines the size of each primitive type. These sizes don’t change from one machine architecture to another as they do in most languages. This size invariance is one reason Java programs are more portable than programs in most other languages.</p>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2eakesoj20ug0emwfh.jpg" alt=""></p>
<p>Primitive type is much faster than wrapper type.</p>
<h4 id="cast"><a class="markdownIt-Anchor" href="#cast"></a> Cast</h4>
<p>When performing narrowing conversions, like casting from a <strong>float</strong> or <strong>double</strong> to an integral value always <strong>truncates</strong> the number. Use <code>Math.round()</code> if you want the result to be rounded.</p>
<p>If you perform any mathematical or bitwise operations on primitive data types that are smaller than an <strong>int</strong> (that is, <strong>char</strong>, <strong>byte</strong>, or <strong>short</strong>), those values will be promoted to <strong>int</strong> before performing the operations, and the resulting value will be of type <strong>int</strong>.</p>
<h3 id="prefer-primitive-types-to-boxed-primitives"><a class="markdownIt-Anchor" href="#prefer-primitive-types-to-boxed-primitives"></a> Prefer primitive types to boxed primitives</h3>
<p>Primitive type is fast. But cannot be used in Generics. Also, boxed primitive actually has additional value: null.</p>
<h3 id="high-precision-numbers"><a class="markdownIt-Anchor" href="#high-precision-numbers"></a> High-precision numbers</h3>
<p><strong>BigInteger</strong> supports arbitrary-precision integers. This means that you can accurately represent integral values of any size without losing any information during operations.<br>
<strong>BigDecimal</strong> is for arbitrary-precision fixed-point numbers; you can use these for accurate monetary calculations, for example.</p>
<p>BigInteger has functions <code>valueOf(int)</code>, <code>add</code>, <code>multiply</code>, <code>divide</code>, <code>remainder</code>. BigInteger class internally uses array of integers for processing. BigIntegers are not as fast as on primitives that is add function on BigIntgers doesn’t take constant time it takes time proportional to length of BigInteger.</p>
<h3 id="avoid-float-and-double-if-exact-answers-are-required"><a class="markdownIt-Anchor" href="#avoid-float-and-double-if-exact-answers-are-required"></a> Avoid <code>float</code> and <code>double</code> if exact answers are required</h3>
<h2 id="control-flow"><a class="markdownIt-Anchor" href="#control-flow"></a> Control Flow</h2>
<h3 id="iterate"><a class="markdownIt-Anchor" href="#iterate"></a> Iterate</h3>
<ul>
<li>for</li>
<li>foreach</li>
<li>break and continue
<ul>
<li>label: The <em>only</em> place a label is useful in Java is <strong>right before</strong> an iteration statement.</li>
</ul>
</li>
</ul>
<h3 id="prefer-for-each-loops-to-traditional-for-loop"><a class="markdownIt-Anchor" href="#prefer-for-each-loops-to-traditional-for-loop"></a> Prefer <code>for-each</code> loops to traditional <code>for</code> loop</h3>
<h2 id="objects-creation"><a class="markdownIt-Anchor" href="#objects-creation"></a> Objects creation</h2>
<h3 id="consider-static-factory-methods"><a class="markdownIt-Anchor" href="#consider-static-factory-methods"></a> Consider static factory methods</h3>
<p>A class can provide a public <code>static factory method</code>, which is simply <strong>a static method that returns an instance of the class</strong>.</p>
<p>Providing a static factory method instead of a public constructor has both advantages and disadvantages.</p>
<ul>
<li>Pros
<ul>
<li>One advantage of static factory methods is that, unlike constructors, they have <strong>names</strong>. In cases where a class seems to require multiple constructors <strong>with the same signature</strong>, replace the constructors with static factory methods and carefully chosen names to highlight their differences.</li>
<li>Unlike constructors, they are NOT required to create a new object each time they’re invoked. This allows immutable classes to use <strong>preconstructed</strong> instances, or to cache instances as they’re constructed, and dispense them repeatedly to <strong>avoid creating unnecessary duplicate objects</strong>.</li>
<li>They can return an object of any subtype of their return type. The programmer knows that the returned object has precisely the API specified by its interface, so there is no need to read additional class documentation for the implementation class. Take an example of <code>Collections</code>. It provides forty-five utility implementations of its interfaces, providing unmodifiable collections, synchronized collections, and the like. Nearly all of these implementations are exported via static factory methods in one non-instantiable class (<code>java.util.Collections</code>).</li>
<li>The class of the returned object can <strong>vary</strong> from call to call as a function of the input parameters. The <code>EnumSet</code> class has no public constructors, only static factories. They return an instance of one of two subclasses, depending on the size of the underlying enum type.</li>
<li>The class of the returned object need not exist when the class containing the method is written. It can be registered after compile to class. Like JDBC.</li>
</ul>
</li>
<li>Cons
<ul>
<li>Classes without public or protected constructors cannot be sub-classed.</li>
<li>They are hard for programmers to find.</li>
</ul>
</li>
</ul>
<p>Here are some common names for static factory methods.</p>
<ul>
<li><strong>from</strong>: A type-conversion method that takes a single parameter and returns a corresponding instance of this type. <code>Date d = Date.from(instant);</code></li>
<li><strong>of</strong>: An aggregation method that takes multiple parameters and returns an instance of this type that incorporates them. <code>Set&lt;Rank&gt; faceCards = EnumSet.of(JACK, QUEEN, KING);</code></li>
<li><strong>valueOf</strong>: A more verbose alternative to from and of, for example: <code>BigInteger prime = BigInteger.valueOf(Integer.MAX_VALUE);</code></li>
<li><strong>instance</strong> or <strong>getInstance</strong>: Returns an instance that is described by its parameters (if any) but cannot be said to have the same value, for example: <code>StackWalker luke = StackWalker.getInstance(options);</code></li>
<li><strong>create</strong> or <strong>newInstance</strong>: Like instance or getInstance, except that the method <strong>guarantees</strong> that each call returns a new instance, for example: <code>Object newArray = Array.newInstance(classObject, arrayLen)</code>;</li>
<li><strong>get<em>Type</em></strong>: Like getInstance, but used if the factory method is in a different class. Type is the type of object returned by the factory method, for example: <code>FileStore fs = Files.getFileStore(path);</code></li>
<li><strong>new<em>Type</em></strong>: Like newInstance, but used if the factory method is in a different class. Type is the type of object returned by the factory method, for example: <code>BufferedReader br = Files.newBufferedReader(path);</code></li>
<li><strong>type</strong>: A concise alternative to <code>getType</code> and <code>newType</code>, for example: <code>List&lt;Complaint&gt; litany = Collections.list(legacyLitany);</code></li>
</ul>
<h3 id="consider-a-builder"><a class="markdownIt-Anchor" href="#consider-a-builder"></a> Consider a builder</h3>
<p><strong>Telescoping constructer pattern</strong>: not scalable, hard to read, hard to write.<br>
<strong>JavaBean pattern</strong>: inconsistent state partway through its construction due to thread safety. And precludes the possibility of making a class immutable.</p>
<p><strong>Builder pattern</strong>: Client calls a constructor (or static factory) with all of the required parameters and gets a <code>builder</code> object. Then the client calls setter-like methods on the builder object to set each optional parameter of interest. Finally, the client calls a parameterless build method to generate the object, which is typically immutable.</p>
<p>The Builder pattern simulates named optional parameters as found in Python and Scala.<br>
To detect invalid parameters as soon as possible, check parameter validity in the builder’s constructor and methods.<br>
The Builder pattern is well suited to class hierarchies, and can combined with <code>covariant return typing</code>.</p>
<p>In summary, the Builder pattern is a good choice when designing classes whose constructors or static factories would have <strong>more than a handful of parameters</strong>.</p>
<h3 id="consider-singleton"><a class="markdownIt-Anchor" href="#consider-singleton"></a> Consider singleton</h3>
<p>A singleton is simply a class that is instantiated exactly once. But it may lacks of ability to accept parameters.</p>
<p>There are three common ways to implement singletons. The first and second are based on <strong>keeping the constructor private</strong> and <strong>exporting a public static member</strong> to provide access to the sole instance. The third are <code>Enum</code>.</p>
<p>In one approach, the public member is a final field:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123; </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis(); </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>In the second approach, the public member is a static factory method</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Elvis INSTANCE = <span class="keyword">new</span> Elvis(); </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Elvis</span><span class="params">()</span> </span>&#123; ... &#125; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Elvis <span class="title">getInstance</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> INSTANCE; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>One advantage of the static factory approach is that it gives you the flexibility to change your mind about whether the class is a singleton without changing its API.</p>
<p>To maintain the singleton guarantee while serializable, declare all <strong>instance</strong> fields <strong>transient</strong> and provide a <code>readResolve</code> method</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    <span class="comment">// Return the one true Elvis and let the garbage collector </span></span><br><span class="line">    <span class="comment">// take care of the Elvis impersonator. </span></span><br><span class="line">    <span class="keyword">return</span> INSTANCE; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A third way to implement a singleton is to declare a single-element enum:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Elvis &#123; </span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It is more concise, provides the serialization machinery for free, and provides an ironclad guarantee against multiple instantiation, even in the face of sophisticated serialization or reflection attacks. A single-element enum type is often the best way to implement a singleton.</p>
<p>If you need to defend against reflection attack, modify the constructor to make it throw an exception if it’s asked to create a second instance.</p>
<p>Static utility classes and singletons are inappropriate for classes whose behavior is parameterized by an underlying resource.</p>
<h3 id="enforce-non-insatiability-with-private-constructor"><a class="markdownIt-Anchor" href="#enforce-non-insatiability-with-private-constructor"></a> Enforce non-insatiability with private constructor</h3>
<p>A class can be made noninstantiable by including a private constructor:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UtilityClass</span> </span>&#123; </span><br><span class="line">    <span class="comment">// Suppress default constructor for noninstantiability </span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">UtilityClass</span><span class="params">()</span> </span>&#123; <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(); &#125; </span><br><span class="line">    ... </span><br><span class="line">    <span class="comment">// Remainder omitted </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Static utility classes and singletons are inappropriate for classes whose behavior is parameterized by an underlying resource.</p>
<h3 id="apply-dependency-injection-when-flexibility-is-required-during-object-creation"><a class="markdownIt-Anchor" href="#apply-dependency-injection-when-flexibility-is-required-during-object-creation"></a> Apply dependency injection when flexibility is required during object creation</h3>
<p>Do not use a singleton or static utility class to implement a class that depends on one or more underlying resources whose behavior affects that of the class, and do not have the class create these resources directly. Instead, pass the resources, or factories to create them, into the constructor (or static factory or builder).</p>
<h3 id="eliminate-obsolete-references"><a class="markdownIt-Anchor" href="#eliminate-obsolete-references"></a> Eliminate obsolete references</h3>
<p>You code maintains <strong>obsolete</strong> references to some objects. An obsolete reference is simply a reference that will never be dereferenced again. It will prevent garbage collector to collect that object, which is a source of memory leak.</p>
<h3 id="avoid-creating-unnecessary-objects"><a class="markdownIt-Anchor" href="#avoid-creating-unnecessary-objects"></a> Avoid creating unnecessary objects</h3>
<ul>
<li>reuse immutable objects when applicable. <code>Boolean.valueOf(String)</code>.</li>
<li>avoid create complicated objects in a loop, like we can create <code>Pattern</code> instance advanced.</li>
<li>prefer primitives to boxed primitives, and watch out for unintentional autoboxing. avoid autoboxing inside a loop.</li>
<li>avoiding object creation by maintaining your own object pool is a bad idea unless the objects in the pool are extremely heavyweight.</li>
<li>Note that the penalty for reusing an object when defensive copying is called for is far greater than the penalty for needlessly creating a duplicate object. Failing to make defensive copies where required can lead to insidious bugs and security holes; creating objects unnecessarily merely affects style and performance.</li>
</ul>
<h2 id="objects-common-contraction"><a class="markdownIt-Anchor" href="#objects-common-contraction"></a> Objects common contraction</h2>
<p>Although object is a concrete class, it is designed primarily for extension. All of its nonfinal methods (<code>equals</code>, <code>hashCode</code>, <code>toString</code>, <code>clone</code>, and <code>finalize</code>) have explicit general contracts because they are designed to be overridden.</p>
<h3 id="override-equals"><a class="markdownIt-Anchor" href="#override-equals"></a> Override <code>equals</code></h3>
<p>So when is it appropriate to override equals? It is when a class has a notion of <strong>logical equality</strong> that differs from mere object identity and a superclass has not already overridden equals. This is generally the case for value classes. A value class is simply a class that represents a value, such as <code>Integer</code> or <code>String</code>. Not only is overriding the equals method necessary to satisfy programmer expectations, it enables instances to serve as map keys or set elements with predictable, desirable behavior.</p>
<p><strong>The equals method implements an equivalence relation. It has these properties:</strong></p>
<ul>
<li><strong>Reflexive</strong>: For any non-null reference value x, <code>x.equals(x)</code> must return true.</li>
<li><strong>Symmetric</strong>: For any non-null reference values x and y, <code>x.equals(y)</code> must return true if and only if <code>y.equals(x)</code> returns true. <strong>It is particular important when x is inherit from y.</strong></li>
<li><strong>Transitive</strong>: For any non-null reference values x, y, z, if <code>x.equals(y)</code> returns true and <code>y.equals(z)</code> returns true, then <code>x.equals(z)</code> must return true. <strong>It is particular important when x is inherit from y.</strong></li>
<li><strong>Consistent</strong>: For any non-null reference values x and y, multiple invocations of <code>x.equals(y)</code> must consistently return true or consistently return false, provided no information used in equals comparisons is modified.</li>
<li>For any non-null reference value x, <code>x.equals(null)</code> must return false.</li>
</ul>
<p><strong>Putting it all together, here’s a recipe for a high-quality equals method:</strong></p>
<ol>
<li><strong>Use the == operator to check if the argument is a reference to this object.</strong> If so, return true. This is just a performance optimization but one that is worth doing if the comparison is potentially expensive.</li>
<li><strong>Use the <code>instanceof</code> operator to check if the argument has the correct type.</strong> If not, return false. Typically, the correct type is the class in which the method occurs. Occasionally, it is some interface implemented by this class. Use an interface if the class implements an interface that refines the equals contract to permit comparisons across classes that implement the interface. Collection interfaces such as Set, List, Map, and Map.Entry have this property.</li>
<li><strong>Cast the argument to the correct type.</strong> Because this cast was preceded by an instanceof test, it is guaranteed to succeed.</li>
<li><strong>For each “significant” field in the class, check if that field of the argument matches the corresponding field of this object.</strong> For primitive fields whose type is not float or double, use the == operator for comparisons; for object reference fields, call the equals method recursively; for float fields, use the static Float.compare(float, float) method; and for double fields, use Double.compare(double, double). For array fields, apply these guidelines to each element.</li>
<li>The performance of the equals method may be affected by the order in which fields are compared. For best performance, you should first compare fields that are more likely to differ, less expensive to compare, or, ideally, both.</li>
<li>You need not compare derived fields, which can be calculated from “significant fields,”</li>
</ol>
<p>Here are a few final caveats:</p>
<ul>
<li>Always override <code>hashCode</code> when you override <code>equals</code>.</li>
<li>Don’t try to be too clever.</li>
<li>Don’t substitute another type for Object in the equals declaration.</li>
</ul>
<p>In summary, don’t override the equals method unless you have to: in many cases, the implementation inherited from Object does exactly what you want. If you do override equals, make sure to compare all of the class’s significant fields and to compare them in a manner that preserves all five provisions of the equals contract.</p>
<h3 id="override-hashcode-when-you-override-equals"><a class="markdownIt-Anchor" href="#override-hashcode-when-you-override-equals"></a> Override <code>hashCode</code> when you override equals</h3>
<p><strong>You must override <code>hashCode</code> in every class that overrides equals.</strong> Or you class will behave wrong in collections such as <code>HashMap</code> and <code>HashSet</code>.</p>
<p>Here is the contract, adapted from the Object specification :</p>
<ul>
<li>When the <code>hashCode</code> method is invoked on an object <strong>repeatedly</strong> during an execution of an application, it must consistently return the same value, provided no information used in equals comparisons is modified. This value need not remain consistent from one execution of an application to another.</li>
<li>If two objects are <strong>equal</strong> according to the <code>equals(Object)</code> method, then calling <code>hashCode</code> on the two objects must <strong>produce the same integer result</strong>.</li>
<li>If two objects are <code>unequal</code> according to the <strong>equals(Object)</strong> method, it is NOT required that calling <code>hashCode</code> on each of the objects must produce distinct results. However, the programmer should be aware that <strong>producing distinct results for unequal objects may improve the performance of hash tables</strong>.</li>
</ul>
<p>A good hash function tends to produce unequal hash codes for unequal instances. Ideally, a hash function should distribute any reasonable collection of unequal instances uniformly across all int values.</p>
<p>Here is a simple recipe:</p>
<ul>
<li>Declare an int variable named <strong>result</strong>, and <strong>initialize it to the hash code c for the first significant field in your object</strong>, as computed in step 2.a.</li>
<li>For every remaining significant field f in your object, do the following:
<ul>
<li>Compute an int hash code c for the field:
<ul>
<li>If the field is of a <strong>primitive type</strong>, compute <code>Type.hashCode(f)</code>, where Type is the boxed primitive class corresponding to f’s type.</li>
<li>If the field is an <strong>object reference</strong> and this class’s equals method compares the field by recursively invoking equals, recursively invoke <code>hashCode</code> on the field. If a more complex comparison is required, compute a “canonical representation” for this field and invoke <code>hashCode</code> on the canonical representation. If the value of the field is null, use 0 (or some other constant, but 0 is traditional).</li>
<li>If the field is an array, treat it as if each significant element were a separate field. That is, compute a hash code for each significant element by applying these rules recursively, and combine the values per step 2. If the array has no significant elements, use a constant, preferably not 0. If all elements are significant, use <code>Arrays.hashCode</code>.</li>
</ul>
</li>
<li>Combine the hash code c computed into result as follows:<code>result = 31 * result + c;</code></li>
</ul>
</li>
<li>Return result.</li>
</ul>
<p>You may exclude derived fields from the hash code computation. In other words, you may ignore any field whose value can be computed from fields included in the computation. You must exclude any fields that are not used in equals comparisons.</p>
<p>As much as is reasonably practical, the <code>hashCode</code> method defined by class <code>Object</code> does return distinct integers for distinct objects. (This is typically implemented by <strong>converting the internal address</strong> of the object into an integer, but this implementation technique is not required by the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mtext>Java</mtext><mtext>TM</mtext></msup></mrow><annotation encoding="application/x-tex">\text{Java}^{\text{TM}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.914561em;"></span><span class="strut bottom" style="height:0.914561em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord text"><span class="mord">Java</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.914561em;"><span style="top:-3.1362300000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">TM</span></span></span></span></span></span></span></span></span></span></span></span></span> programming language.)</p>
<p><strong>For <code>String</code> class</strong>, the default <code>hashCode</code> is:<br>
Returns a hash code for this string. The hash code for a <code>String</code> object is computed as</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]</span><br></pre></td></tr></table></figure>
<p>using <code>int</code> arithmetic, where <code>s[i]</code> is the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding="application/x-tex">i^{th}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.849108em;"></span><span class="strut bottom" style="height:0.849108em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathit">i</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">t</span><span class="mord mathit mtight">h</span></span></span></span></span></span></span></span></span></span></span></span> character of the string, <code>n</code> is the length of the string, and <code>^</code> indicates exponentiation. (The hash value of the empty string is zero.).<br>
The reason to choose 31 is that 31 is a <strong>prime</strong>. Here is a decent explanation of <a href="https://computinglife.wordpress.com/2008/11/20/why-do-hash-functions-use-prime-numbers/" target="_blank" rel="noopener">Why do hash function use prime number</a> .</p>
<p>For <code>Intellij</code> Generated <code>hashCode</code> function is:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Objects.hash(Object[] a);</span><br><span class="line"><span class="comment">// Actual implementation in Arrays.hashCode</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">(Object a[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (Object element : a)</span><br><span class="line">        result = <span class="number">31</span> * result + (element == <span class="keyword">null</span> ? <span class="number">0</span> : element.hashCode());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="override-tostring"><a class="markdownIt-Anchor" href="#override-tostring"></a> Override <code>toString</code></h3>
<p>a concise but informative representation that is easy for a person to read.  If you specify the format, it’s usually a good idea to provide a matching static factory or constructor so programmers can easily translate back and forth between the object and its string representation. Whether or not you decide to specify the format, you should clearly document your intentions.</p>
<p>Provide programmatic access to the information contained in the value returned by <code>toString</code>.</p>
<h3 id="override-clone-judiciously"><a class="markdownIt-Anchor" href="#override-clone-judiciously"></a> Override <code>clone</code> judiciously</h3>
<p>What is <code>Cloneable</code>?<br>
It determines the behavior of Object’s protected <code>clone</code> implementation: if a class implements Cloneable, <strong>Object’s clone method returns a field-by-field copy of the object</strong>.</p>
<p>In practice, a class implementing Cloneable is expected to provide a properly functioning public clone method.</p>
<p>In effect, the clone method functions as a constructor; you must ensure that it does no harm to the original object and that it properly establishes invariants on the clone.</p>
<h3 id="implement-comparable"><a class="markdownIt-Anchor" href="#implement-comparable"></a> Implement <code>Comparable</code></h3>
<p>Specification</p>
<ul>
<li><code>sgn(x.compareTo(y)) == -sgn(y. compareTo(x))</code> for all x and y. (This implies that <code>x.compareTo(y)</code> must throw an <code>if and only if</code>y.compareTo(x)` throws an exception.)  If the first object is less than the second, then the second must be greater than the first; if the first object is equal to the second, then the second must be equal to the first; and if the first object is greater than the second, then the second must be less than the first.</li>
<li>The relation is <strong>transitive</strong>: <code>(x. compareTo(y) &gt; 0 &amp;&amp; y.compareTo(z) &gt; 0)</code> implies <code>x.compareTo(z) &gt; 0</code>. If one object is greater than a second and the second is greater than a third, then the first must be greater than the third.</li>
<li><code>x.compareTo(y) == 0</code> implies that <code>sgn(x.compareTo(z)) == sgn(y.compareTo(z))</code>, for all z. All objects that compare as equal must yield the same results when compared to any other object.</li>
<li>It is strongly recommended, but not required, that <code>(x.compareTo(y) == 0) == (x.equals(y))</code>. Generally speaking, any class that implements the Comparable interface and violates this condition should clearly indicate this fact. The recommended language is “Note: This class has a natural ordering that is inconsistent with equals.”</li>
</ul>
<p>Hints:</p>
<ul>
<li>Use of the relational operators &lt; and &gt; in <code>compareTo</code> methods is <strong>verbose and error-prone and no longer recommended</strong>. Use <code>Double.compare</code>.</li>
<li>It is not a good idea to use <code>a-b</code> in <code>compareTo</code>: overflow.</li>
<li>Be careful of the order you compare.</li>
</ul>
<h2 id="scope"><a class="markdownIt-Anchor" href="#scope"></a> Scope</h2>
<p>Scope is determined by the placement of curly braces {}. For example.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;    </span><br><span class="line">    <span class="keyword">int</span> x = <span class="number">12</span>;    <span class="comment">// Only x available  </span></span><br><span class="line">	&#123;    </span><br><span class="line">        <span class="keyword">int</span> q = <span class="number">96</span>;    <span class="comment">// Both x &amp; q available  </span></span><br><span class="line">    &#125;    </span><br><span class="line">    <span class="comment">// Only x available    </span></span><br><span class="line">    <span class="comment">// q is "out of scope"  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A variable defined within a scope is available only to the end of that scope. And the “hide” behavior is NOT allowed.</p>
<h3 id="minimize-the-scope-of-local-variables"><a class="markdownIt-Anchor" href="#minimize-the-scope-of-local-variables"></a> Minimize the scope of local variables</h3>
<h3 id="minimize-the-accessibility-of-classes"><a class="markdownIt-Anchor" href="#minimize-the-accessibility-of-classes"></a> Minimize the accessibility of classes</h3>
<h3 id="in-public-classes-use-accessor"><a class="markdownIt-Anchor" href="#in-public-classes-use-accessor"></a> In public classes, use accessor</h3>
<h2 id="strings"><a class="markdownIt-Anchor" href="#strings"></a> Strings</h2>
<p>Objects of the String class are <strong>immutable</strong>. Every method in the class that appears to modify a String actually creates and returns a brand new String object containing the modification. The original String is left untouched.</p>
<h3 id="format"><a class="markdownIt-Anchor" href="#format"></a> Format</h3>
<p>Directly print using <code>Systeom.out.format()</code> or <code>System.out.printf()</code>.<br>
Or we can directly use <code>Formatter</code> to print.<br>
If only the string object is desirable, use <code>String.format</code>. Under the hood, all <code>String.format( )</code> does is instantiate a Formatter and pass your arguments to it, but using this convenience method can often be clearer and easier than doing it by hand.</p>
<h3 id="avoid-string-where-other-types-are-more-appropriate"><a class="markdownIt-Anchor" href="#avoid-string-where-other-types-are-more-appropriate"></a> Avoid <code>String</code> where other types are more appropriate</h3>
<h3 id="beware-the-performance-of-string-concatenation"><a class="markdownIt-Anchor" href="#beware-the-performance-of-string-concatenation"></a> Beware the performance of string concatenation</h3>
<p>P380</p>
<h2 id="others"><a class="markdownIt-Anchor" href="#others"></a> Others</h2>
<h3 id="use-native-methods-judiciously"><a class="markdownIt-Anchor" href="#use-native-methods-judiciously"></a> Use native methods judiciously</h3>
<h3 id="optimize-judiciously"><a class="markdownIt-Anchor" href="#optimize-judiciously"></a> Optimize judiciously</h3>
<h3 id="adhere-to-generally-accepted-naming-conventions"><a class="markdownIt-Anchor" href="#adhere-to-generally-accepted-naming-conventions"></a> Adhere to generally accepted naming conventions</h3>
<h1 id="class"><a class="markdownIt-Anchor" href="#class"></a> Class</h1>
<h2 id="basic"><a class="markdownIt-Anchor" href="#basic"></a> Basic</h2>
<p>You manipulate objects with references.</p>
<h3 id="method-overloading"><a class="markdownIt-Anchor" href="#method-overloading"></a> Method overloading</h3>
<p><strong>Distinguishing overloaded methods</strong></p>
<p><strong>Overloading with primitives</strong><br>
If an overloaded method is available that takes exactly same type argument, it is used. If not, it tries to find most recent version of method.</p>
<p><strong>Overloading on return values</strong><br>
Blank <strong>finals</strong><br>
<strong>final arguments</strong><br>
<strong>final methods</strong><br>
<strong>final and private</strong></p>
<h2 id="initialization"><a class="markdownIt-Anchor" href="#initialization"></a> Initialization</h2>
<p><strong>Guaranteed initialization with the constructor</strong><br>
Constructor is special static method<br>
<strong>Default constructors</strong><br>
<strong>The <code>This</code> keyword</strong><br>
<strong>Calling constructors from constructors</strong><br>
When you write several constructors for a class, there are times when you’d like to call one constructor from another to avoid duplicating code. You can make such a call by using the <strong>this</strong> keyword.</p>
<p><strong>Member initialization:</strong> each field of a class is guaranteed to get an initial value, like 0 or null.<br>
<strong>Specifying initialization:</strong>  you can initialize by using constant primitive, new object or a method. A method can have arguments, of course, but those arguments cannot be other class members that haven’t been initialized yet.</p>
<h3 id="initialization-order"><a class="markdownIt-Anchor" href="#initialization-order"></a> Initialization order</h3>
<p>Within a class, the order of initialization is determined by the <strong>order</strong> that the variables are <strong>defined</strong> within the class. The variable definitions may be scattered throughout and in between method definitions. But when compiled to <code>class</code> file, it is combined to a single <code>cinit</code> method (for static variables) and <code>init</code> method (for members) that only appears in <code>.class</code> file. The variables are initialized before any methods can be called—even the constructor.</p>
<p>When the <code>class initialization</code> started, the static members and static blocks will be executed one by one, which is exactly the <code>cinit</code> method.</p>
<p>When we require an object using <code>new</code> keyword, first the members and blocks will be executed one by one, which is exactly the <code>init</code> method. Then the constructor is called.</p>
<p>Only when a parent class is initialized/ a parent object is created, the child can be initialized/created.</p>
<p>Of course, super member and blocks is executed first.</p>
<p>Let’s combine the process mentioned above.</p>
<ul>
<li>initialize base class static field (only once)</li>
<li>initialize derived class static field (only once)</li>
<li>initialize base class by calling a proper constructor in derived class. It can
<ul>
<li>initialize base class members</li>
<li>execute base class constructor</li>
</ul>
</li>
<li>initialize derived class members</li>
<li>execute derived class constructor</li>
</ul>
<h3 id="when-does-initialization-occurs"><a class="markdownIt-Anchor" href="#when-does-initialization-occurs"></a> When does initialization occurs</h3>
<p>In the section, <strong>initialization</strong> explicitly points to a concept used in JVM, not common meaning in Java. In JVM, once a class is initialized, it may not even call the constructor.</p>
<ol>
<li>Encountered bytecode like <code>new</code>, <code>getstatic</code>, <code>putstatic</code> or <code>invokestatic</code> . The most common scene is:
<ol>
<li>instantiate an object using <code>new</code></li>
<li>get or set a static field (except <code>final static</code> field that has been compiled and put into constant pool)</li>
<li>call a static method of a class</li>
</ol>
</li>
<li>Used <code>java.lang.reflect</code> to call the class</li>
<li>Super class will be initialized when initialize a sub class, if the super class has not been initialized.</li>
<li>Initialized class which has <code>main</code> method when JVM started.</li>
</ol>
<p>After the initialization finished, the class’ <strong>static</strong> variables and methods can be used.</p>
<p><strong>Caution</strong>:</p>
<p>1.For static member, only the direct class will be initialized.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = SubClass.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"SuperClass init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> value = <span class="number">123</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubClass</span> <span class="keyword">extends</span> <span class="title">SuperClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"SubClass init"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It will only print out <code>SuperClass init</code>. And if we chance <code>value</code> to <code>static final</code>, it will print nothing.</p>
<p>2.If declared an Array, it does not initialize that class, because an array is a specific class which class name is <code>[zeqiang.SubClass</code> . It is generated by JVM and inherited by <code>java.lang.Object</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SuperClass[] sca = <span class="keyword">new</span> SuperClass[<span class="number">10</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.Inteface is a little different in the 3rd condition: it does not require super class to be initialized when a class is initialized.</p>
<h2 id="clean"><a class="markdownIt-Anchor" href="#clean"></a> Clean</h2>
<p>If there is some activity that must be performed before you no longer need an object, you must perform that activity yourself. Java has no destructor or similar concept, so you must create an ordinary method to perform this cleanup.</p>
<p>There are two ways: <code>finalize()</code> and <code>cleaner()</code>. In most case, finalizer is not a good idea, nether does cleaner.</p>
<h3 id="finalizers"><a class="markdownIt-Anchor" href="#finalizers"></a> Finalizers</h3>
<p><strong>Finalizers are unpredictable, often dangerous, and generally unnecessary.</strong></p>
<p>Java garbage collector can reclaim the memory of objects that are no longer used which is created using <code>new</code>. But if we want to release the memory allocated by a native method, GC is not able to handle the case. That’s why Java provides <code>finalize()</code>. So if you choose to use finalize( ), it gives you the ability to perform some important cleanup <u>at the time of garbage collection</u>.</p>
<p>Here is 3 important notes:</p>
<ol>
<li>Your objects might not get garbage collected.</li>
<li>Garbage collection is not destruction.</li>
<li>Garbage collection is only about memory.  So any activity that is associated with garbage collection, most notably your <code>finalize( )</code> method, must also be ONLY about memory and its deallocation.</li>
</ol>
<h4 id="the-termination-condition"><a class="markdownIt-Anchor" href="#the-termination-condition"></a> The termination condition</h4>
<p>In general, you can’t rely on finalize( ) being called, and you must create separate “cleanup” methods and call them explicitly.</p>
<p>However, there is an interesting use of finalize( ) that does not rely on it being called every time. This is the verification of the termination condition of an object.</p>
<p>At the point that you’re no longer interested in an object—when it’s ready to be cleaned up— that object should be in a state whereby its memory can be safely released. For example, if the object represents an open file, that file should be closed by the programmer before the object is garbage collected. If any portions of the object are not properly cleaned up, then you have a bug in your program that can be very difficult to find. finalize( ) can be used to eventually discover this condition, even if it isn’t always called. If one of the finalizations happens to reveal the bug, then you discover the problem, which is all you really care about.</p>
<h3 id="cleaners"><a class="markdownIt-Anchor" href="#cleaners"></a> Cleaners</h3>
<p>Cleaners are less dangerous than finalizers, but still unpredictable, slow, and generally unnecessary.</p>
<h3 id="avoid-finalizers-and-cleaners"><a class="markdownIt-Anchor" href="#avoid-finalizers-and-cleaners"></a> Avoid finalizers and cleaners</h3>
<p>Finalizers are unpredictable, often dangerous, and generally unnecessary. Cleaners are less dangerous than finalizers, but still unpredictable, slow, and generally unnecessary.<br>
You should never do anything time-critical in a finalizer or cleaner.<br>
Not only does the specification provide no guarantee that finalizers or cleaners will run promptly; it provides no guarantee that they’ll run at all.<br>
Another problem with finalizers is that an uncaught exception thrown during finalization is ignored.<br>
There is a severe performance penalty for using finalizers and cleaners.<br>
Finalizers have a serious security problem: they open your class up to finalizer attacks.</p>
<p>So what should you do instead of writing a finalizer or cleaner for a class whose objects encapsulate resources that require termination, such as files or threads? Just have your class <strong>implement <code>AutoCloseable</code></strong>, and require its clients to invoke the close method on each instance when it is no longer needed, typically using <code>try-with-resources</code> to ensure termination even in the face of exceptions.</p>
<p>In summary, don’t use cleaners, or in releases prior to Java 9, finalizers, except as a <strong>safety net</strong> or to <strong>terminate noncritical native resources</strong>. Even then, beware the indeterminacy and performance consequences.</p>
<h2 id="inheritance"><a class="markdownIt-Anchor" href="#inheritance"></a> Inheritance</h2>
<p><strong>Method</strong>: A Subclass derived from a Base Class, it automatically gets all public, package and protected methods. And you can <strong>override</strong> the methods you inherit. If you want to call a super class version method, call it using <code>super.method()</code>.</p>
<p><strong>Field:</strong> automatically get all public, package and protected field. But in derive class, it can hide variable in base class. After that, base class’s field can only be called by super.x inside derived class.</p>
<p><strong>Initialization:</strong> When you create an object of the derived class, it contains within it a subobject of the base class. Of course, it’s essential that the base-class subobject be initialized correctly, and there’s only one way to guarantee this: Perform the initialization in the constructor by calling the baseclass constructor, which has all the appropriate knowledge and privileges to perform the base-class initialization. Java <strong>automatically inserts</strong> calls to the base-class constructor in the derived-class constructor.</p>
<p><strong>Important notes</strong>:</p>
<ul>
<li>If the base class does not have a default constructor, derived class has to call it explicitly.</li>
<li><strong>private</strong> method can not be override, but can be hided.</li>
<li>You are better <strong>NOT</strong> call overridable method during construction, because you never know what your subclass will do. But static method and field is OK, they do not have the polymorphism behavior.</li>
</ul>
<h2 id="polymorphism"><a class="markdownIt-Anchor" href="#polymorphism"></a> Polymorphism</h2>
<p>Polymorphism also calls dynamic binding or late binding or run-time binding. It means, the actual type of object is determined at runtime.<br>
Polymorphism means “different forms.” In object-oriented programming, you have the same interface from the base class, and different forms using that interface: the different versions of the dynamically bound methods.</p>
<p>It can facilitate the extensibility of your code, because the method can accept a type (whether a base class type or interface), and anyone can extends/implement the type and send it to the method, even if the derived class is outside of the package of method body.</p>
<h3 id="method-call-binding"><a class="markdownIt-Anchor" href="#method-call-binding"></a> Method-call binding</h3>
<p>Connecting a method call to a method body is called binding. When binding is performed <strong>before the program is run</strong> (by the compiler and linker, if there is one), it’s called <strong>early binding</strong>. You might not have heard the term before because it has never been an option with procedural languages. C compilers have only one kind of method call, and that’s early binding. Late binding, which means that the binding occurs at run time, based on the type of object. Late binding is also called dynamic binding or runtime binding. That is, the compiler still doesn’t know the object type, but the method-call mechanism finds out and calls the correct method body.</p>
<h3 id="pitfall"><a class="markdownIt-Anchor" href="#pitfall"></a> Pitfall</h3>
<p>Only ordinary method calls can be polymorphic.<br>
If you access a <strong>field</strong> directly, that access will be resolved at compile time.<br>
If a method is <strong>static</strong>, it doesn’t behave polymorphically.</p>
<h2 id="inner-class"><a class="markdownIt-Anchor" href="#inner-class"></a> Inner Class</h2>
<p>It’s possible to place a class definition within another class definition. This is called an inner class. The inner class is a valuable feature because it allows you to <strong>group classes</strong> that <strong>logically</strong> belong together and to <strong>control the visibility</strong> of one within the other. However, it’s important to understand that inner classes are distinctly different from composition.</p>
<p>When you create an inner class using <code>outherObject.new</code>, an object of that inner class has a link to the <strong>enclosing object</strong> that made it, and so it can access the members of that enclosing object without any special qualifications, using syntax: <code>Outer.this.field</code>. In addition, inner classes have access rights to all the elements in the enclosing class, including <strong>private</strong>.  Remember, It’s not possible to create an object of the inner class unless you already have an object of the outer class.</p>
<p>Inner classes really come into their own when you start upcasting to a base class, and in particular to an interface. This happens often at a method’s return type. In this way, outer world can only get a reference of public interface, not the actual type of class. In that way, you hide the implementation of detail.</p>
<h3 id="anonymous-inner-classes"><a class="markdownIt-Anchor" href="#anonymous-inner-classes"></a> Anonymous inner classes</h3>
<p>It is an inner class that does not have name, nor does the constructor. So it is often used when we only need an instance that want have some behavior in a certain method that different from the required type. Once we create an anonymous inner class, it basically says: <em>Create an object of an anonymous class that’s inherited from <strong>The Class</strong>.</em></p>
<p>In addition, anonymous class can have fields, it has own scope. If you’re defining an anonymous inner class and want to use an object that’s defined outside the anonymous inner class, the compiler requires that the argument reference be <strong>final</strong>. Of course, the fields do not required to be <strong>final</strong>, only the <strong>argument</strong> and <strong>local field</strong>.</p>
<h3 id="nested-classes"><a class="markdownIt-Anchor" href="#nested-classes"></a> Nested classes</h3>
<p>A nested class is an <strong>inner class with static</strong>, it means:</p>
<ol>
<li>You don’t need an outer-class object in order to create an object of a nested class.</li>
<li>You can’t access a non-static outer-class object from an object of a nested class.</li>
</ol>
<p>A nested class can also access <strong>private static</strong> member. But can not access outer class’s member.</p>
<p><strong>Classes inside interfaces</strong><br>
<strong>Reaching outward from a multiply nested class</strong></p>
<h3 id="why-inner-classes"><a class="markdownIt-Anchor" href="#why-inner-classes"></a> Why inner classes</h3>
<p>Typically, the inner class inherits from a class or implements an interface, and the code in the inner class manipulates the outer-class object that it was created within. So you could say that an inner class provides a kind of <strong>window</strong> into the outer class. Actually, the compiler automatically insert a hidden <code>outer.this</code> pointer in the inner class, which makes it can implictly reference the outer object.</p>
<p>Each inner class can independently inherit from an <strong>implementation</strong>. Thus, the inner class is not limited by whether the outer class is already inheriting from an implementation. Inner classes effectively allow “multiple implementation inheritance.” That is, inner classes effectively allow you to inherit from more than one non-interface.</p>
<p><strong>Closure &amp; callbacks</strong>: you can use inner class to <strong>capture</strong> the object of outer class<br>
<strong>Inner classes &amp; control frameworks</strong>: The elements that should be passed to controller are better to have access to the controller. It makes things easier.<br>
<strong>Inheriting from inner classes</strong>: secret reference to the enclosing  class must be initialized. You need to proved a constructor accepts an enclosing object and at the first line of it, add <code>enclosing.super()</code>.<br>
<strong>inner class does not be inherited when extends the enclosing class</strong></p>
<p><strong>Local inner class</strong><br>
<strong>Inner class identifier</strong></p>
<h1 id="interface"><a class="markdownIt-Anchor" href="#interface"></a> Interface</h1>
<p>Interfaces and abstract  classes provide more structured way to separate interface from implementation.</p>
<p>The interface keyword produces a completely abstract class, one that provides no implementation at all. It allows the creator to determine method names, argument lists, and return types, but no method bodies. An interface provides only a <strong>contract</strong>, but no <strong>implementation</strong>.</p>
<p>Methods in an interface is public implicitly. It can also contain fields, but these are implicitly <strong>static</strong> and <strong>final</strong>.</p>
<h2 id="complete-decoupling"><a class="markdownIt-Anchor" href="#complete-decoupling"></a> Complete decoupling</h2>
<p>Whenever a method works with a class instead of an interface, you are limited to using that class or its subclasses. If you would like to apply the method to a class that isn’t in that hierarchy, you’re out of luck. An interface relaxes this constraint considerably. As a result, it allows you to write more reusable code.</p>
<p>Decoupling interface from implementation allows an interface to be applied to multiple different implementations, and thus your code is more reusable.</p>
<h2 id="multiple-inheritance-in-java"><a class="markdownIt-Anchor" href="#multiple-inheritance-in-java"></a> <em>Multiple inheritance</em> in Java</h2>
<p>You can implement multiple interfaces, each interface is an independent type. And it can be upcasted to more than one base type.</p>
<p><strong>Extending an interface with inheritance</strong><br>
<strong>Name collisions when combining Interface</strong><br>
<strong>Adapting to and interface: Strategy pattern</strong><br>
<strong>Fields in interfaces</strong><br>
<strong>Initializing fields in interfaces</strong><br>
<strong>Nesting interfaces</strong><br>
<strong>Interface and Factory</strong></p>
<h1 id="array-and-container"><a class="markdownIt-Anchor" href="#array-and-container"></a> Array and Container</h1>
<h2 id="array"><a class="markdownIt-Anchor" href="#array"></a> Array</h2>
<p>An array associates numerical indexes to objects. It holds objects of a known type so that you don’t have to cast the result when you’re looking up an object. It can be multidimensional, and it can hold primitives. However, its size cannot be changed once you create it.</p>
<p>There are three issues that distinguish arrays from other types of containers: <strong>efficiency, type, and the ability to hold primitives</strong>.</p>
<p>Arrays are superior to pre-generic containers because you create an array to hold a specific type. This means that you get <strong>compile-time type checking</strong> to prevent you from inserting the wrong type or mistaking the type that you’re extracting.</p>
<p><strong>Initialization:</strong> {1, 2}, new int[2], new int[]{1, 2}<br>
<strong>Arrays are first-class objects</strong><br>
<strong>Returning an array</strong>: do not need to worry about the lifetime of array<br>
<strong>Multidimensional arrays</strong><br>
<strong>Arrays and generics</strong>: In general, arrays and generics do not mix well. But you can create a reference of array with generics, and explicitly cast to the type. It is not type-safe anymore because you can upcast the array to <code>Object[]</code> and pass anyone to it. Because generic is erased during runtime, thus <code>List&lt;String&gt;</code> and <code>List&lt;Integer&gt;</code> are the same type during runtime. It does not throw <code>ArrayStoreException</code>.<br>
<strong>Creating test data</strong>:</p>
<ul>
<li><code>Arrays.fill</code> to produce same value among the array.</li>
<li>Data Generators</li>
</ul>
<p><strong>Arrays utilities</strong></p>
<p><code>Arrays</code> class, which holds a set of <strong>static utility</strong> methods for arrays. There are six basic methods:</p>
<ul>
<li><code>equals( )</code>, to compare two arrays for equality (and a <code>deepEquals( )</code> for multidimensional arrays);  To be equal, the arrays must have the same number of elements, and each element must be equivalent to each corresponding element in the other array, using the <code>equals( )</code> for each element.</li>
<li><code>fill( )</code>, which you’ve seen earlier in this chapter;</li>
<li><code>sort( )</code>, to sort an array; For primitive, use <code>DualPivotQuickSort</code>.For objects, use <code>TimeSort</code>.</li>
<li><code>binarySearch( )</code>, to find an element in a sorted array;</li>
<li><code>toString( )</code>, to produce a String representation for an array; and</li>
<li><code>hashCode( )</code>, to produce the hash value of an array. All of these methods are overloaded for all the primitive types and Objects.</li>
<li><code>Arrays.asList( )</code> takes any sequence or array and turns it into a fixed-size <code>List</code> container.</li>
<li><code>Arrays.copyOf()</code> and <code>Arrays.copyOfRange()</code> takes original array and make a copy using <code>System.arrayCopy()</code>.</li>
<li><code>stream()</code> to return a stream</li>
</ul>
<h2 id="container"><a class="markdownIt-Anchor" href="#container"></a> Container</h2>
<p>The Java container library takes the idea of “holding your objects” and divides it into two distinct concepts, expressed as the basic interfaces of the library:</p>
<ol>
<li><strong>Collection</strong>: <u>a sequence of individual elements with one or more rules applied to them</u>.
<ol>
<li>A <strong>List</strong> must hold the elements in the way that they were inserted,</li>
<li>a <strong>Set</strong> cannot have duplicate elements, and</li>
<li>a <strong>Queue</strong> produces the elements in the order determined by a queuing discipline (usually the same order in which they are inserted).</li>
<li>a <strong>Stack</strong> produces the elements in the order with FILO (First-In-Last-Out)</li>
</ol>
</li>
<li><strong>Map</strong>: <u>a group of key-value object pairs, allowing you to look up a value using a key</u>.
<ol>
<li>An <strong>ArrayList</strong> allows you to look up an object using a number, so in a sense it associates numbers to objects.</li>
<li>A <strong>map</strong> allows you to look up an object using another object. It’s also called an <strong>associative array</strong>, because it associates objects with other objects, or a dictionary, because you look up a value object using a key object just like you look up a definition using a word. <strong>Maps</strong> are powerful programming tools.</li>
</ol>
</li>
</ol>
<p>Both Collections and Maps automatically resize themselves as you add more elements. A container won’t hold primitives, but autoboxing takes care of translating primitives back and forth to the wrapper types held in the container.</p>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2eihuyfj20vu0uomy0.jpg" alt=""></p>
<p><strong>Adding groups of elements</strong>:</p>
<ul>
<li><code>Arrays.asList(T... elements)</code>, the returned list can not be modified</li>
<li><code>Collections.addAll(Collection, T... elements)</code></li>
<li><code>collection.addAll(Collection)</code></li>
<li><code>Constructor</code></li>
</ul>
<h3 id="list"><a class="markdownIt-Anchor" href="#list"></a> List</h3>
<p>Lists promise to maintain elements in a particular sequence. The List interface adds a number of methods to Collection that allow insertion and removal of elements in the middle of a List.</p>
<p>A List can add, remove an element, check if it contains or find index of it, get a subList and so on.</p>
<h4 id="arraylist"><a class="markdownIt-Anchor" href="#arraylist"></a> ArrayList</h4>
<p>ArrayList uses array as underlying data structure, which excels at randomly accessing elements, but is slower when inserting and removing elements in the middle of a List.</p>
<h4 id="arraylist-source-code-analysis"><a class="markdownIt-Anchor" href="#arraylist-source-code-analysis"></a> ArrayList Source Code Analysis</h4>
<h5 id="init"><a class="markdownIt-Anchor" href="#init"></a> init</h5>
<p>reuse an static empty array</p>
<h5 id="add"><a class="markdownIt-Anchor" href="#add"></a> add</h5>
<p>ensureCapacityInternal: if current array length is less than minCapacity, then create new array.<br>
then add element to current size;</p>
<h5 id="modcount"><a class="markdownIt-Anchor" href="#modcount"></a> modCount</h5>
<p>用于检测是在迭代器遍历的时候有额外的写入/删除。在使用迭代器遍历的时候，如果使用ArrayList中的remove(int index) remove(Object o)  remove(int fromIndex ,int toIndex) add等方法的时候都会修改modCount，在迭代的时候需要保持单线程的唯一操作，如果期间进行了插入或者删除，就会被迭代器检查获知，从而出现运行时异常。</p>
<h4 id="linkedlist"><a class="markdownIt-Anchor" href="#linkedlist"></a> LinkedList</h4>
<p>LinkedList provides optimal sequential access, with inexpensive insertions and deletions from the middle of the List. A LinkedList is relatively slow for random access, but it has a larger feature set than the ArrayList.</p>
<p>LinkedList also adds methods that allow it to be used as a <strong>Stack</strong>, a <strong>Queue</strong> or a <strong>double-ended queue (deque)</strong>.</p>
<p>Here is a few methods name:</p>
<ul>
<li><code>getFirst</code>, <code>element</code>: return the head(first element) of list</li>
<li><code>peek</code>: same with above, but does not throw NoSuchElementException</li>
<li><code>removeFirst</code> and <code>remove</code>: remove and return the head of the list</li>
<li><code>poll</code>: same with above, but does not throw NoSuchElementException</li>
<li><code>addFirst</code></li>
<li><code>offer</code>, <code>add</code>, <code>addList</code></li>
<li><code>removeList</code></li>
</ul>
<p><strong>Hint</strong>: Use an ArrayList if you’re doing a lot of random accesses, but a LinkedList if you will be doing a lot of insertions and removals in the middle of the list.</p>
<h4 id="linkedlist-source-code"><a class="markdownIt-Anchor" href="#linkedlist-source-code"></a> LinkedList source code</h4>
<h5 id="add-2"><a class="markdownIt-Anchor" href="#add-2"></a> add</h5>
<p>link to last element</p>
<h5 id="get"><a class="markdownIt-Anchor" href="#get"></a> get</h5>
<p>find last</p>
<h4 id="provided-by-arrays-and-collections"><a class="markdownIt-Anchor" href="#provided-by-arrays-and-collections"></a> Provided by <code>Arrays</code> and  <code>Collections</code></h4>
<ul>
<li><code>Arrays.asList()</code> size is fixed, but can <code>set</code> a different object</li>
<li><code>Collections.unmodifiableList()</code> size is fixed, and cannot modify object.</li>
<li><code>Collections.checkedList()</code> type-safe list, check type at runtime</li>
<li><code>Collections.emptyList()</code> an empty list, can not modify</li>
<li><code>Collections.synchronizedList()</code></li>
</ul>
<h4 id="iterator-listiterator-and-spliterator"><a class="markdownIt-Anchor" href="#iterator-listiterator-and-spliterator"></a> Iterator, ListIterator and Spliterator</h4>
<p>An <strong>iterator</strong> is an object whose job is to move through a sequence and select each object in that sequence without the client programmer knowing or caring about the underlying structure of that sequence.</p>
<p>There’s not much you can do with an <strong>Iterator</strong> except:</p>
<ul>
<li>Ask a Collection to hand you an Iterator using a method called iterator( ). That Iterator will be ready to return the first element in the sequence.</li>
<li>Get the <strong>next</strong> object in the sequence with <code>next( )</code>.</li>
<li>See if there are any more objects in the sequence with <code>hasNext( )</code>.</li>
<li>Remove the last element returned by the iterator with <code>remove( )</code>.</li>
<li><strong>Iterator</strong> can be used in combination of <strong>foreach</strong></li>
</ul>
<p>Java SE5 introduced a new interface called <strong>Iterable</strong> which contains an <code>iterator( )</code> method to produce an <strong>Iterator</strong>, and the Iterable interface is what <code>foreach</code> uses to move through a sequence. Once you implement <strong>Iterable</strong> interface, it is pretty easy to iterate through it using <code>for(T t: youclassExtenseIterable)</code>.</p>
<p>You can use <strong>Adapter pattern</strong> to provide different behavior of iterator.</p>
<p>The <strong>ListIterator</strong> is a more powerful subtype of Iterator that is produced only by List classes. While Iterator can only move forward, ListIterator is <strong>bidirectional</strong>. It can also produce the <strong>indexes of the next and previous</strong> elements relative to where the iterator is pointing in the list, and it can <strong>replace</strong> the last element that it visited using the <code>set( )</code> method.</p>
<p><strong>Spliterator</strong> can be used to provide parallel iteration.</p>
<h3 id="set"><a class="markdownIt-Anchor" href="#set"></a> Set</h3>
<p>The <strong>Set</strong> prevents duplication based on <code>equals</code> method implemented by holding class.</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Requirment</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Set</strong> (interface)</td>
<td>Each element that you add to the Set must be unique; otherwise, the Set doesn’t add the duplicate element. Elements added to a Set must at least define <code>equals( )</code> to establish object uniqueness. Set has exactly the same interface as Collection. The Set interface does not guarantee that it will maintain its elements in any particular order.</td>
</tr>
<tr>
<td><strong>HashSet</strong></td>
<td>For Sets where fast lookup time is important. Elements must also define <code>hashCode( )</code>.</td>
</tr>
<tr>
<td><strong>TreeSet</strong></td>
<td>An ordered <code>Set</code> backed by a tree. This way, you can extract an ordered sequence from a Set. Elements must also implement the <code>Comparable</code> interface.</td>
</tr>
<tr>
<td><strong>LinkedHashSet</strong></td>
<td>Has the lookup speed of a <code>HashSet</code>, but internally maintains the order in which you add the elements (the insertion order) using a linked list. Thus, when you iterate through the Set, the results appear in insertion order. Elements must also define <code>hashCode( )</code>.</td>
</tr>
</tbody>
</table>
<h4 id="sortedset"><a class="markdownIt-Anchor" href="#sortedset"></a> SortedSet</h4>
<p>The elements in a <strong>SortedSet</strong> are guaranteed to be in sorted order, which allows additional functionality to be provided with the following methods that are in the <strong>SortedSet</strong> interface:</p>
<ul>
<li>
<p><code>Comparator comparator( )</code>: Produces the Comparator used for this Set, or null for natural ordering.</p>
</li>
<li>
<p><code>Object first( )</code>: Produces the lowest element.</p>
</li>
<li>
<p><code>Object last( )</code>: Produces the highest element.</p>
</li>
<li>
<p><code>SortedSet subSet(fromElement, toElement)</code>: Produces a view of this Set with elements from <code>fromElement</code>, inclusive, to <code>toElement</code>, exclusive.</p>
</li>
<li>
<p><code>SortedSet headSet(toElement)</code>: Produces a view of this Set with elements less than <code>toElement</code>.</p>
</li>
<li>
<p><code>SortedSet tailSet(fromElement)</code>: Produces a view of this Set with elements greater than or equal to <code>fromElement</code>.</p>
</li>
</ul>
<h3 id="queue"><a class="markdownIt-Anchor" href="#queue"></a> Queue</h3>
<p>A queue is typically a “first-in, first-out&quot; (FIFO) container. LinkedList has methods to support queue behavior and it implements the Queue interface, so a LinkedList can be used as a Queue implementation.</p>
<h4 id="priorityqueue"><a class="markdownIt-Anchor" href="#priorityqueue"></a> PriorityQueue</h4>
<p>A <strong>priority queue</strong> says that the element that goes next is the one with the greatest need (the highest priority). The default sorting uses the natural order of the objects in the queue, but you can modify the order by providing your own Comparator.</p>
<h4 id="deque"><a class="markdownIt-Anchor" href="#deque"></a> Deque</h4>
<p>A deque (double-ended queue) is like a queue, but you can add and remove elements from either end. There are methods in LinkedList that support deque operations, but there is no explicit interface for a deque in the Java standard libraries.</p>
<h4 id="blockingqueue"><a class="markdownIt-Anchor" href="#blockingqueue"></a> BlockingQueue</h4>
<p>In multi-thread world, you can solve task cooperation problems using a <strong>synchronized queue</strong>, which only allows one task at a time to insert or remove an element. This is provided for you in the <code>java.util.concurrent.BlockingQueue</code> interface.  You’ll usually use the <code>LinkedBlockingQueue</code>, which is an unbounded queue; the <code>ArrayBlockingQueue</code> has a fixed size. But don’t be afraid, basically it implements a producer-consumer queue using <code>await()</code> and <code>signal()</code>.  So you can put more elements than the actual array size, and when the count is less than array.size, it will wake up and put elements in array again.</p>
<h2 id="map"><a class="markdownIt-Anchor" href="#map"></a> Map</h2>
<p><strong>Map</strong> allows you to look up an object using another object. It is a collection of key-value pair.</p>
<p>The standard Java library contains different basic implementations of Maps: <code>HashMap</code>, <code>TreeMap</code>, <code>LinkedHashMap</code>, <code>WeakHashMap</code>, <code>ConcurrentHashMap</code>, and <code>IdentityHashMap</code>.</p>
<table>
<thead>
<tr>
<th>CLASS</th>
<th>REQUIREMENT</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>HashMap</code></td>
<td>Implementation based on a hash table. Provides constant-time performance for inserting and locating pairs. Performance can be adjusted via constructors that allow you to set the <strong>capacity</strong> and <strong>load factor</strong> of the hash table.</td>
</tr>
<tr>
<td><code>LinkedHashMap</code></td>
<td>Like a <code>HashMap</code>, but when you iterate through it, you get the pairs in <strong>insertion order</strong>, or in <strong>least-recently-used (LRU)</strong> order. Only slightly slower than a <code>HashMap</code>, except when iterating, where it is faster due to the linked list used to maintain the internal ordering.</td>
</tr>
<tr>
<td><code>TreeMap</code></td>
<td>Implementation based on a red-black tree. When you view the keys or the pairs, they will be in <strong>sorted order</strong> (determined by Comparable or Comparator). The point of a <code>TreeMap</code> is that you get the results in sorted order. <code>TreeMap</code> is the only Map with the <code>subMap()</code> method, which allows you to return a portion of the tree.</td>
</tr>
<tr>
<td><code>WeakHashMap</code></td>
<td>A map of <strong>weak</strong> keys that allow objects referred to by the map to be released; designed to solve certain types of problems. If no references to a particular key are held outside the map, that key may be garbage collected.</td>
</tr>
<tr>
<td><code>ConcurrentHashMap</code></td>
<td>A <strong>thread-safe Map</strong> which does not involve synchronization locking. This is discussed in the Concurrency chapter.</td>
</tr>
<tr>
<td><code>IdentityHashMap</code></td>
<td>A hash map that uses == instead of <code>equals( )</code> to compare keys. Only for solving special types of problems; not for general use</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="https://blog.csdn.net/carson_ho/article/details/79373134" target="_blank" rel="noopener">Java源码分析：关于 HashMap 1.8 的重大更新</a></p>
</blockquote>
<h3 id="holding-references"><a class="markdownIt-Anchor" href="#holding-references"></a> Holding references</h3>
<p>If an object is <strong>reachable</strong>, it means that somewhere in your program the object can be found. This could mean that you have an ordinary reference on the stack that goes right to the object.</p>
<p>You use <strong>Reference</strong> objects when you want to continue to hold on to a reference to that object—you want to reach that object—but you also want to allow the garbage collector to release that object. Thus, you have a way to use the object, but if memory exhaustion is imminent, you allow that object to be released.</p>
<p>You accomplish this by using a <strong>Reference</strong> object as an intermediary (a proxy) between you and the ordinary reference. In addition, there must be <strong>no ordinary references</strong> to the object (ones that are not wrapped inside Reference objects). If the garbage collector discovers that an object is reachable through an ordinary reference, it will not release that object.</p>
<p>In the order of <code>SoftReference</code>, <code>WeakReference</code>, and <code>PhantomReference</code>, each one is “weaker” than the last and corresponds to a different level of reachability.</p>
<p><strong>Soft references</strong> are for implementing memory-sensitive caches. <strong>Weak references</strong> are for implementing “canonicalizing mappings”—where instances of objects can be simultaneously used in multiple places in a program, to save storage—that do not prevent their keys (or values) from being reclaimed. <strong>Phantom reference</strong>s are for scheduling pre-mortem cleanup actions in a more flexible way than is possible with the Java finalization mechanism.</p>
<h3 id="weakhashmap"><a class="markdownIt-Anchor" href="#weakhashmap"></a> <code>WeakHashMap</code></h3>
<p>The containers library has a special Map to hold weak references: the <code>WeakHashMap</code>.  In such a mapping, you are saving storage by creating only one instance of a particular value. When the program needs that value, it looks up the existing object in the mapping and uses that. Since this is a storage-saving technique, it’s very convenient that the <code>WeakHashMap</code> allows the garbage collector to automatically clean up the keys and values.</p>
<p><img src="https://pic4.zhimg.com/80/d643d9ab5c933ac475cfa23063bed137_hd.jpg" alt="img"></p>
<h1 id="exception"><a class="markdownIt-Anchor" href="#exception"></a> Exception</h1>
<h2 id="concepts"><a class="markdownIt-Anchor" href="#concepts"></a> Concepts</h2>
<p>An <strong>exceptional condition</strong> is a problem that prevents the continuation of the current method or scope. With an exceptional condition, you cannot continue processing because you don’t have the information necessary to deal with the problem in the current context. All you can do is jump out of the current context and relegate that problem to a higher context. This is what happens when you throw an exception.</p>
<p>When you throw an exception, several things happen. First, the exception object is created in the same way that any Java object is created: on the heap, with new. Then the current path of execution (the one you couldn’t continue) is stopped and the reference for the exception object is ejected from the current context. At this point the exception-handling mechanism takes over and begins to look for an appropriate place to continue executing the program. This appropriate place is the exception handler, whose job is to recover from the problem so the program can either try another tack or just continue.</p>
<p>The basic idea is that the name of the exception represents the problem that occurred, and the exception name is intended to be relatively self-explanatory.</p>
<h2 id="throwable-error-and-exception"><a class="markdownIt-Anchor" href="#throwable-error-and-exception"></a> Throwable, Error and Exception</h2>
<p><code>Throwable</code> is base class or <code>Error</code> and <code>Exception</code>. <code>Throwable</code> represents all kinds of wrong behavior happens in your program. <code>Error</code> throwed when JVM encountered a fatal error that cannot be recovered. <code>Exception</code> means the programmers can take an effor to recover from exception. <code>RuntimeException</code> is subclass of <code>Exception</code>. It does not need to be checked, because it represents a kind of programmer error, that happens in runtime.</p>
<p><code>Throwable</code> has methods:</p>
<ul>
<li><code>String getMessage()</code></li>
<li><code>String getLocalizedMessage( )</code> Gets the detail message, or a message adjusted for this particular locale.</li>
<li><code>String toString( )</code>  Returns a short description of the Throwable, including the detail message if there is one.</li>
<li><code>void printStackTrace( )</code>, <code>void printStackTrace(PrintStream)</code> and <code>void printStackTrace(java.io.PrintWriter)</code>  Prints the Throwable and the Throwable’s call stack trace. The call stack shows the sequence of method calls that brought you to the point at which the exception was thrown. The first version prints to standard error, the second and third print to a stream of your choice</li>
<li><code>Throwable fillInStackTrace( )</code>  Records information within this Throwable object about the current state of the stack frames. Useful when an application is rethrowing an error or exception.</li>
<li><code>StackTraceElement getStackTrace( )</code>This method returns an array of stack trace elements, each representing one stack frame. Element zero is the top of the stack, and is the last method invocation in the sequence.</li>
</ul>
<h2 id="cleanup-with-finally"><a class="markdownIt-Anchor" href="#cleanup-with-finally"></a> Cleanup with finally</h2>
<p>There’s often some piece of code that you want to execute whether or not an exception is thrown within a <strong>try</strong> block. The <strong>finally</strong> clause is necessary when you need to set something other than memory back to its original state. This is some kind of cleanup like an open file or network connection, something you’ve drawn on the screen.</p>
<p>Even return inside <strong>try</strong> block will perform <strong>finally</strong> block, but if you return inside finally block, you will lost all exception information.</p>
<h2 id="best-practice"><a class="markdownIt-Anchor" href="#best-practice"></a> Best practice</h2>
<h3 id="prefer-try-with-resources-to-try-finally"><a class="markdownIt-Anchor" href="#prefer-try-with-resources-to-try-finally"></a> Prefer <code>try-with-resources</code> to <code>try-finally</code></h3>
<p>Historically, a <code>try-finally</code> statement was the best way to guarantee that a resource would be closed properly. But it is always used wrong, and become ugly when use multiple resources. The code in both the try block and the finally block is capable of throwing exceptions. And the exception in finally will completely obliterates the exception thrown in try block.</p>
<p><code>try-with-resources</code> can make life easier. It can auto close classes that implements <code>AutoCloseable</code>. Also, it can operate on multiple resources, for example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (InputStream in = <span class="keyword">new</span> FileInputStream(<span class="string">""</span>);</span><br><span class="line">     OutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="string">""</span>)) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If exceptions are thrown by both the try block and the (invisible) <code>close</code>, the latter exception is <em>suppressed</em> in favor of the former. In fact, multiple exceptions may be <em>suppressed</em> in order to preserve the exception that you actually want to see. These suppressed exceptions are not merely discarded; they are printed in the stack trace with a notation saying that they were suppressed.</p>
<p><strong>Always use <code>try-with-resources</code> in preference to <code>try-finally</code> when working with resources that must be closed.</strong></p>
<p>Use exceptions only for exceptional conditions<br>
Use checked exceptions for recoverable and conditions and runtime exceptions for programming errors<br>
Avoid unnecessary use of checked exceptions<br>
Favor the use of checked exceptions<br>
Throw exceptions appropriate to the abstraction<br>
Document all exceptions thrown by each method<br>
Include failure-capture information in detail messages<br>
Strive for failure atomicity<br>
Don’t ignore exceptions</p>
<h1 id="enum-and-annotation"><a class="markdownIt-Anchor" href="#enum-and-annotation"></a> Enum and Annotation</h1>
<h2 id="enum"><a class="markdownIt-Anchor" href="#enum"></a> Enum</h2>
<p>The <strong>enum</strong> keyword allows you to create a new type with a restricted set of named values, and to treat those values as regular program components.</p>
<p><strong>values()</strong>: produces an array of the enum constants in the order in which they were declared.<br>
<strong>ordinal()</strong>: produces an int indicating the declaration order of each enum instance, starting from zero.<br>
<strong>Enum.valueOf()</strong>:  produces the enum instance that corresponds to the String name you pass to it, or throws an exception if there’s no match.<br>
<strong>name()</strong>: produces the name exactly as it is declared.</p>
<p>When you create an enum, an associated class is produced for you by the compiler. This class is automatically inherited from <code>java.lang.Enum</code>. You can always safely compare enum instances using ==, and <code>equals( )</code> and <code>hashCode( )</code> are automatically created for you. The Enum class is <code>Comparable</code>, so there’s a <code>compareTo( )</code> method, and it is also <code>Serializable</code>.</p>
<p>You can add fields, constructors and methods to an <strong>enum</strong> like a common class. Of course, you cannot create an enum instance, it is done by JVM. Each enum element is a static final instance of enum.</p>
<p><strong>Enum</strong> can not inherit other class because it is already inherit <code>java.lang.Enum</code>. But it can implement interfaces.</p>
<p><strong>Enum</strong> can also add constant-specific methods. It allows you to give each enum instance different behavior by creating methods for each one. To do this, you define one or more abstract methods as part of the enum, then define the methods for each enum instance.</p>
<h3 id="use-enum-instead-of-int-constants"><a class="markdownIt-Anchor" href="#use-enum-instead-of-int-constants"></a> Use <code>Enum</code> instead of <code>int</code> constants</h3>
<h3 id="use-instance-fields-instead-of-ordinals"><a class="markdownIt-Anchor" href="#use-instance-fields-instead-of-ordinals"></a> Use instance fields instead of ordinals</h3>
<h3 id="use-enumset-instead-of-bit-fields"><a class="markdownIt-Anchor" href="#use-enumset-instead-of-bit-fields"></a> Use <code>EnumSet</code> instead of bit fields</h3>
<h3 id="use-enummap-instead-of-ordinal-indexing"><a class="markdownIt-Anchor" href="#use-enummap-instead-of-ordinal-indexing"></a> Use <code>EnumMap</code> instead of ordinal indexing</h3>
<h3 id="emulate-extensible-enums-with-interfaces"><a class="markdownIt-Anchor" href="#emulate-extensible-enums-with-interfaces"></a> Emulate extensible enums with interfaces</h3>
<h2 id="annotations"><a class="markdownIt-Anchor" href="#annotations"></a> Annotations</h2>
<p>Annotations (also known as metadata) provide a formalized way to add information to your code so that you can easily use that data at some later point.</p>
<p>Annotations are one of the fundamental language changes introduced in Java SE5. <u>They provide information that you need to fully describe your program, but that cannot be expressed in Java.</u> Thus, annotations allow you to</p>
<ul>
<li>store extra information about your program in a format that is tested and verified by the compiler.</li>
<li>generate descriptor files or even new class definitions and help ease the burden of writing “boilerplate” code.</li>
<li>keep this metadata in the Java source code, and have the advantage of cleaner looking code, compile-time type checking and the annotation API to help build processing tools for your annotations.</li>
</ul>
<h3 id="define-annotation"><a class="markdownIt-Anchor" href="#define-annotation"></a> Define Annotation</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(ElementType.METHOD) </span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME) </span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UseCase &#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> "no description"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Target</code> defines where you can apply this annotation (a method or a field, for example). <code>@Retention</code> defines whether the annotations are available in the source code (SOURCE), in the class files (CLASS), or at run time (RUNTIME).</p>
<table>
<thead>
<tr>
<th>Annotation</th>
<th>Info</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Target</td>
<td>Where this annotation can be applied. The possible <strong>ElementType</strong> arguments are:  <strong>CONSTRUCTOR</strong>: Constructor declaration  <strong>FIELD</strong>: Field declaration (includes enum constants) <strong>LOCAL_VARIABLE</strong>: Local variable declaration <strong>METHOD</strong>: Method declaration <strong>PACKAGE</strong>: Package declaration  <strong>PARAMETER</strong>: Parameter declaration  <strong>TYPE</strong>: Class, interface (including annotation type),  or <strong>enum</strong> declaration</td>
</tr>
<tr>
<td>@Retention</td>
<td>How long the annotation information is kept. The possible <strong>RetentionPolicy</strong> arguments are:  <strong>SOURCE</strong>: Annotations are discarded by the  compiler.  <strong>CLASS</strong>: Annotations are available in the class file by the compiler but can be discarded by the VM. <strong>RUNTIME</strong>: Annotations are retained by the VM at run time, so they may be read reflectively.</td>
</tr>
<tr>
<td>@Documented</td>
<td>Include this annotation in the Javadocs.</td>
</tr>
<tr>
<td>@Inherited</td>
<td>Allow subclasses to inherit parent annotations.</td>
</tr>
</tbody>
</table>
<p><strong>Allowed annotation elements</strong></p>
<ul>
<li>String</li>
<li>Class</li>
<li>Enums</li>
<li>Annotations</li>
<li>Arrays of any of the above  All primitives (int, float, boolean etc.)</li>
</ul>
<h3 id="prefer-annotations-to-naming-patterns"><a class="markdownIt-Anchor" href="#prefer-annotations-to-naming-patterns"></a> Prefer annotations to naming patterns</h3>
<h3 id="consistently-use-the-override-annotation"><a class="markdownIt-Anchor" href="#consistently-use-the-override-annotation"></a> Consistently use the Override annotation</h3>
<h3 id="use-marker-interface-to-define-types"><a class="markdownIt-Anchor" href="#use-marker-interface-to-define-types"></a> Use marker interface to define types</h3>
<h1 id="generics-and-types"><a class="markdownIt-Anchor" href="#generics-and-types"></a> Generics and Types</h1>
<h2 id="types"><a class="markdownIt-Anchor" href="#types"></a> Types</h2>
<p><strong>Runtime type information (RTTI)</strong> allows you to discover and use type information while a program is running. You may have upcast <code>ArrayList</code> to <code>List</code>, but still you can get the actual class information using <strong>RTTI</strong>.</p>
<p>Type information is represented at run time using <code>Class</code> object. The <code>Class</code> object is used to create all of the “<code>regular</code>” objects of your class. Java performs its <strong>RTTI</strong> using the <code>Class</code> object, even if you’re doing something like a cast.</p>
<h3 id="class-object"><a class="markdownIt-Anchor" href="#class-object"></a> Class object</h3>
<p>There’s one <strong>Class</strong> object for <strong>each</strong> class that is part of your program. That is, each time you write and compile a new class, a single Class object is also created (and stored, appropriately enough, in an identically named .class file). To make an object of that class, the Java Virtual Machine (JVM) that’s executing your program uses a subsystem called a <strong>class loader</strong>.</p>
<p>Java program isn’t completely loaded before it begins, but instead pieces of it are loaded when <strong>necessary</strong>.</p>
<p>The class loader first checks to see if the Class object for that type is loaded. If not, the default class loader finds the .class file with that name (an add-on class loader might, for example, look for the bytecodes in a database instead). As the bytes for the class are loaded, they are verified to ensure that they have not been corrupted and that they do not comprise bad Java code (this is one of the lines of defense for security in Java).</p>
<p>You can get <code>Class</code> object by:</p>
<ul>
<li><code>Class.forName(String)</code>  initializes the class <strong>immediately</strong> in order to produce the Class reference</li>
<li><code>object.getClass()</code></li>
<li><code>ClassName.class</code> (class literal) which is not only simpler, but also safer since it’s checked at compile time (and thus does not need to be placed in a try block). Create a reference to a <strong>Class</strong> object using <code>.class</code> doesn’t automatically initialize the <strong>Class</strong> object.</li>
</ul>
<p>You can check before a cast using:</p>
<ul>
<li>static <code>instanceof</code>: <code>if (object instanceof Class)</code>. Are you this class, or a class derived from this class?</li>
<li>A dynamic <code>instanceof</code>: <code>classObject.isInstance(object)</code>. Are you this class, or a class derived from this class?</li>
<li><code>Class</code> equivalence: <code>==</code> or <code>equals</code>. test for equality. No concern with inheritance</li>
</ul>
<h3 id="dynamic-proxies"><a class="markdownIt-Anchor" href="#dynamic-proxies"></a> Dynamic proxies</h3>
<p><strong>Proxy</strong> is one of the basic design patterns. It is an object that you insert in place of the “real” object in order to provide additional or different operations—these usually involve communication with a “real” object, so a proxy typically acts as a go-between. <strong>Java’s dynamic proxy</strong> takes the idea of a proxy one step further, by both creating the proxy object dynamically and handling calls to the proxied methods dynamically. All calls made on a dynamic proxy are redirected to a <strong>single invocation handler</strong>, which has the job of discovering what the call is and deciding what to do about it.</p>
<p>You create a dynamic proxy by calling the static method <code>Proxy.newProxyInstance( )</code>, which requires a <strong>class loader</strong> (you can generally just hand it a class loader from an object that has already been loaded), <strong>a list of interfaces</strong> (not classes or abstract classes) that you wish the proxy to implement, and an implementation of the interface <code>InvocationHandler</code>.</p>
<h2 id="generics"><a class="markdownIt-Anchor" href="#generics"></a> Generics</h2>
<p>Generics implement the concept of parameterized types, which allow multiple types. The term “generic” means “pertaining or appropriate to large groups of classes.” One of the most compelling initial motivations for generics is to create <strong>container</strong> classes.</p>
<p>It works with</p>
<ul>
<li>type parameter: <code>List&lt;Integer&gt;</code></li>
<li>interface/class: <code>public interface Comparable&lt;T&gt;</code></li>
<li>method: <code>public &lt;T extends Number&gt; T add(T t1, T t2)</code></li>
</ul>
<p>It is possible to explicitly specify the type in a generic method, which is <code>list.&lt;A&gt;add(object)</code>. You can’t create arrays of generics.</p>
<p><strong>There’s no information about generic parameter types available inside generic code.</strong>  Java generics are implemented using erasure. This means that any specific type information is erased when you use a generic. Inside the generic, the only thing that you know is that you’re using an object. So <code>List&lt;String&gt;</code> and <code>List&lt;Integer&gt;</code> are, in fact, the same type at run time.</p>
<p><strong>Bounds</strong>:</p>
<ul>
<li>Wildcard <code>? extend</code></li>
<li>Contravariance <code>? super</code></li>
<li>Unbounded wildcards <code>?</code></li>
</ul>
<p><strong>Issues:</strong></p>
<ul>
<li>No primitives as type parameters</li>
<li>Implementing parameterized interfaces</li>
<li>Casting and warnings</li>
<li>Overloading</li>
<li>Base class hijacks an interface</li>
</ul>
<p><strong>Self-bounded types</strong></p>
<p>Don’t use raw types<br>
Eliminate unchecked warnings<br>
Prefer lists to arrays<br>
Favor generic types<br>
Favor generic methods<br>
Use bounded wildcards to increase API flexibility<br>
Combine generics and varargs judiciously<br>
Consider typesafe heterogeneous containers</p>
<h1 id="io"><a class="markdownIt-Anchor" href="#io"></a> I/O</h1>
<p><strong>File</strong>: It can represent either the name of a particular file or the names of a set of files in a directory.</p>
<h2 id="inputstream-and-outputstram"><a class="markdownIt-Anchor" href="#inputstream-and-outputstram"></a> <code>InputStream</code> and <code>OutputStram</code></h2>
<p>Programming language I/O libraries often use the abstraction of a <strong>stream</strong>, which represents any <strong>data source or sink</strong> as an object capable of producing or receiving pieces of data. The stream hides the details of what happens to the data inside the actual I/O device.</p>
<p>The Java library classes for I/O are divided by input and output. Through inheritance, everything derived from the <code>InputStream</code> or <code>Reader</code> classes has basic methods called <code>read( )</code> for reading a single byte or an array of bytes. Likewise, everything derived from <code>OutputStream</code> or <code>Writer</code> classes has basic methods called <code>write( )</code> for writing a single byte or an array of bytes. However, y<u>ou won’t generally use these methods</u>; they exist so that other classes can use them—these other classes provide a more useful interface. Thus, you’ll rarely create your stream object by using a single class, but instead <u>will layer multiple objects together to provide your desired functionality</u>. The fact that you create more than one object to produce a single stream is the primary reason that Java’s I/O library is confusing.</p>
<h3 id="types-of-inputstream"><a class="markdownIt-Anchor" href="#types-of-inputstream"></a> Types of <code>InputStream</code></h3>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2eq4llmj20re0oyq56.jpg" alt=""></p>
<h3 id="types-of-outputstream"><a class="markdownIt-Anchor" href="#types-of-outputstream"></a> Types of <code>OutputStream</code></h3>
<p>This category includes the classes that decide where your output will go.</p>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2fb3njkj20sc0fqdh5.jpg" alt=""></p>
<h2 id="adding-attributes-and-useful-interfaces"><a class="markdownIt-Anchor" href="#adding-attributes-and-useful-interfaces"></a> Adding attributes and useful interfaces</h2>
<p>The Java I/O library requires many different combinations of features, and this is the justification for using the Decorator design pattern. The classes that provide the decorator interface to control a particular <code>InputStream</code> or <code>OutputStream</code> are the <code>FilterlnputStream</code> and <code>FilterOutputStream</code>, which don’t have very intuitive names. <code>FilterlnputStream</code> and <code>FilterOutputStream</code> are derived from the base classes of the I/O library, <code>InputStream</code> and <code>OutputStream</code>, which is a key requirement of the decorator (so that it provides the common interface to all the objects that are being decorated).</p>
<h3 id="reading-from-inputstream-with-filterlnputstream"><a class="markdownIt-Anchor" href="#reading-from-inputstream-with-filterlnputstream"></a> Reading from <code>InputStream</code> with <code>FilterlnputStream</code></h3>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2ewl7qwj20tn0j3405.jpg" alt=""></p>
<h3 id="writing-to-an-outputstream-with-filteroutputstream"><a class="markdownIt-Anchor" href="#writing-to-an-outputstream-with-filteroutputstream"></a> Writing to an <code>OutputStream</code> with <code>FilterOutputStream</code></h3>
<p><code>PrintStream</code> can be problematic because it traps all <code>IOExceptions</code> (you must explicitly test the error status with <code>checkError( )</code>, which returns true if an error has occurred). Also, <code>PrintStream</code> doesn’t internationalize properly and doesn’t handle line breaks in a platform-independent way. These problems are solved with <code>PrintWriter</code>, described later.</p>
<p><code>BufferedOutputStream</code> is a modifier and tells the stream to use buffering so you don’t get a physical write every time you write to the stream. You’ll probably <strong>always</strong> want to use this when doing output.</p>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2f2ng9zj20s20c0my5.jpg" alt=""></p>
<h2 id="readers-and-writers"><a class="markdownIt-Anchor" href="#readers-and-writers"></a> Readers and Writers</h2>
<p><strong>Reader and Writer</strong> are not meant to replace the <code>InputStream</code> and <code>OutputStream</code>. The <code>InputStream</code> and <code>OutputStream</code> classes provide valuable functionality in the form of <strong>byte-oriented</strong> I/O, whereas the <code>Reader</code> and <code>Writer</code> classes provide <strong>Unicode-compliant, character-based</strong> I/O.</p>
<p>Here is a table that shows the correspondence between the sources and sinks of information (that is, where the data physically comes from or goes to) in the two hierarchies.</p>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2fvo4ffj20qi0lrdgx.jpg" alt=""></p>
<p>Modifying stream behavior: For <code>InputStreams</code> and <code>OutputStreams</code>, streams were adapted for particular needs using “decorator” subclasses of <code>FilterInputStream</code> and <code>FilterOutputStream</code>. The <code>Reader</code> and <code>Writer</code> class hierarchies continue the use of this idea—but not exactly.</p>
<p><img src="http://o9bjjf9jh.bkt.clouddn.com/blog/180903/H9451f09ci.png?imageslim" alt="mark"></p>
<p><img src="http://o9bjjf9jh.bkt.clouddn.com/blog/180903/KH50deggfC.png?imageslim" alt="mark"></p>
<p>There’s one direction that’s quite clear: Whenever you want to use <code>readLine( )</code>, you shouldn’t do it with a <code>DataInputStream</code> (this is met with a deprecation message at compile time), but instead use a <code>BufferedReader</code>. Other than this, <code>DataInputStream</code> is still a “preferred” member of the I/O library.</p>
<h2 id="new-io"><a class="markdownIt-Anchor" href="#new-io"></a> New I/O</h2>
<p>The Java “new” I/O library, introduced in JDK 1.4 in the <code>java.nio.*</code> packages, has one goal: speed. In fact, the “old” I/O packages have been reimplemented using <code>nio</code> in order to take advantage of this speed increase, so you will benefit even if you don’t explicitly write code with <code>nio</code>.</p>
<p>The speed comes from using structures that are closer to the operating system’s way of performing I/O: <strong>channels and buffers</strong>. You could think of it as a coal mine; the channel is the mine containing the seam of coal (the data), and the buffer is the cart that you send into the mine. The cart comes back full of coal, and you get the coal from the cart. That is, you don’t interact directly with the channel; you interact with the buffer and send the buffer into the channel. The channel either pulls data from the buffer, or puts data into the buffer.</p>
<p>The only kind of buffer that communicates directly with a channel is a <code>ByteBuffer</code>—that is, a buffer that holds raw bytes. If you look at the JDK documentation for <code>java.nio.ByteBuffer</code>, you’ll see that it’s fairly basic: You create one by telling it how much storage to allocate, and there are methods to <strong>put and get data</strong>, in either raw byte form or as primitive data types. But there’s no way to put or get an object, or even a String. It’s fairly low-level, precisely because this makes a more efficient mapping with most operating systems.</p>
<h3 id="basic-usage"><a class="markdownIt-Anchor" href="#basic-usage"></a> Basic usage</h3>
<p><code>FileInputStream</code> , <code>FileOutputStream</code> and <code>RandomAccessFile</code> can produce a <code>FileChannel</code> by <code>getChannel()</code> method.  A channel is fairly basic: You can hand it a <code>ByteBuffer</code> for <strong>reading or writing</strong>, and you can <strong>lock regions of the file</strong> for exclusive access.</p>
<p>You can create <code>ByteBuffer</code> using <code>wrap()</code> method, the underlying array is not copied. Or allocate a <code>ByteBuffer</code> using <code>static allocate()</code> method. The goal of <code>nio</code> is to rapidly move large amounts of data, so the size of the <code>ByteBuffer</code> should be significant.</p>
<p>A <code>FileChannel</code> can write the content of a <code>ByteBuffer</code> to <code>outputstream</code> or read the value stored in <code>ByteBuffer</code> from <code>InputStream</code>. Once you call <code>read()</code> to tell the <code>FileChannel</code> to store bytes into the <code>ByteBuffer</code>, you must call <code>flip()</code> on the buffer to tell it to get ready to have its bytes extracted. And if we were to use the buffer for further <code>read()</code> operations, we’d also have to call <code>clear()</code> to prepare it for each <code>read()</code>.</p>
<p>Special methods <code>transferTo()</code> and <code>transferFrom()</code> allow you to connect one channel directly to another.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">FileChannel</span><br><span class="line">	in = <span class="keyword">new</span> FileInputStream(args[<span class="number">0</span>]).getChannel(),</span><br><span class="line">	out = <span class="keyword">new</span> FileOutputStream(args[<span class="number">1</span>]).getChannel(); </span><br><span class="line">in.transferTo(<span class="number">0</span>, in.size(), out);</span><br><span class="line"><span class="comment">// or: </span></span><br><span class="line"><span class="comment">// out.transferFrom(in, 0, in.size());</span></span><br></pre></td></tr></table></figure>
<h3 id="view-buffers"><a class="markdownIt-Anchor" href="#view-buffers"></a> View buffers</h3>
<p>A “view buffer” allows you to look at an underlying <code>ByteBuffer</code> through the window of a particular primitive type.</p>
<p>Like <code>asIntBuffer</code>, <code>asCharBuffer</code>.</p>
<p><img src="https://ws1.sinaimg.cn/large/df637165ly1fwy2g2vjwmj20y30jpgm6.jpg" alt=""></p>
<h2 id="typical-use-of-io-streams"><a class="markdownIt-Anchor" href="#typical-use-of-io-streams"></a> Typical use of I/O streams</h2>
<p>Buffered input file:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BufferedReader in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(filename));</span><br><span class="line">String s;</span><br><span class="line"><span class="keyword">while</span>((s = in.readLine())!= <span class="keyword">null</span>)</span><br><span class="line">    sb.append(s + <span class="string">"\n"</span>);</span><br></pre></td></tr></table></figure>
<p>Input from memory:<br>
The String is used to create a <code>StringReader</code>. Then <code>read()</code> is used to read each character one at a time and send it out to the console.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StringReader in = <span class="keyword">new</span> StringReader(<span class="string">"Hello"</span>);</span><br><span class="line"><span class="keyword">int</span> c;</span><br><span class="line"><span class="keyword">while</span>((c = in.read()) != -<span class="number">1</span>)</span><br><span class="line">    System.out.print((<span class="keyword">char</span>)c);</span><br></pre></td></tr></table></figure>
<p>Formatted memory input:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DataInputStream in = <span class="keyword">new</span> DataInputStream(</span><br><span class="line">    <span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"TestEOF.java"</span>)));     <span class="keyword">while</span>(in.available() != <span class="number">0</span>)</span><br><span class="line">     System.out.print((<span class="keyword">char</span>)in.readByte());</span><br></pre></td></tr></table></figure>
<h2 id="standard-io"><a class="markdownIt-Anchor" href="#standard-io"></a> Standard I/O</h2>
<p>Following the standard I/O model, Java has <code>System.in</code>, <code>System.out</code>, and <code>System.err</code>。 Throughout this book, you’ve seen how to write to standard output using <code>System.out</code>, which is already pre-wrapped as a <code>PrintStream</code> object. <code>System.err</code> is likewise a <code>PrintStream</code>, but <code>System.in</code> is a raw <code>InputStream</code> with no wrapping. This means that although you can use <code>System.out</code> and <code>System.err</code> right away, <code>System.in</code> must be wrapped before you can read from it.</p>
<p>The Java System class allows you to <strong>redirect the standard input, output, and error</strong> I/O streams using simple static method calls:</p>
<ul>
<li><code>setIn(InputStream)</code></li>
<li><code>setOut(PrintStream)</code></li>
<li><code>setErr(PrintStream)</code></li>
</ul>
<h1 id="concurrency"><a class="markdownIt-Anchor" href="#concurrency"></a> Concurrency</h1>
<p>If you have a multiprocessor machine, multiple tasks can be distributed across those processors, which can dramatically improve throughput. This is often the case with powerful multiprocessor Web servers, which can distribute large numbers of user requests across CPUs in a program that allocates one thread per request.<br>
However, concurrency can often improve the performance of programs running on a single processor.</p>
<p>This can sound a bit counterintuitive. If you think about it, a concurrent program running on a single processor should actually have more overhead than if all the parts of the program ran sequentially, because of the added cost of the so-called context switch (changing from one task to another). On the surface, it would appear to be cheaper to run all the parts of the program as a single task and save the cost of context switching.<br>
The issue that can make a difference is blocking. If one task in your program is unable to continue because of some condition outside of the control of the program (typically I/O), we say that the task or the thread blocks. Without concurrency, the whole program comes to a stop until the external condition changes. If the program is written using concurrency, however, the other tasks in the program can continue to execute when one task is blocked, so the program continues to move forward. In fact, from a performance standpoint, it makes no sense to use concurrency on a single-processor machine unless one of the tasks might block.</p>
<p>A very common example of performance improvements in single-processor systems is event driven programming. Indeed, one of the most compelling reasons for using concurrency is to produce a responsive user interface. Consider a program that performs some long-running operation and thus ends up ignoring user input and being unresponsive. If you have a “quit” button, you don’t want to be forced to poll it in every piece of code you write. This produces awkward code, without any guarantee that a programmer won’t forget to perform the check. Without concurrency, the only way to produce a responsive user interface is for all tasks to periodically check for user input. By creating a separate thread of execution to respond to user input, even though this thread will be blocked most of the time, the program guarantees a certain level of responsiveness.</p>
<p>Concurrent programming allows you to partition a program into separate, independently running tasks. Using <strong>multithreading</strong>, each of these independent tasks (also called <strong>subtasks</strong>) is driven by a <strong>thread of execution</strong>. A <strong>thread</strong> is a <strong>single sequential flow of control</strong> within a process. A single process can thus have multiple concurrently executing tasks, but you program as if each task has the CPU to itself.</p>
<p>The threading model is a programming convenience to simplify juggling several operations at the same time within a single program: The CPU will pop around and give each task some of its time.</p>
<h2 id="thread-states"><a class="markdownIt-Anchor" href="#thread-states"></a> Thread states</h2>
<p>A thread can be in any one of four states:</p>
<ol>
<li>
<p><strong>New</strong>: A thread remains in this state only momentarily, as it is being created. It allocates any necessary system resources and performs initialization. At this point it becomes eligible to receive CPU time. The scheduler will then transition this thread to the runnable or blocked state.</p>
</li>
<li>
<p><strong>Runnable</strong>: This means that a thread can be run when the time-slicing mechanism has CPU cycles available for the thread. Thus, the thread might or might not be running at any moment, but there’s nothing to prevent it from being run if the scheduler can arrange it. That is, it’s not dead or blocked.</p>
</li>
<li>
<p><strong>Blocked</strong>: The thread can be run, but something prevents it. While a thread is in the blocked state, the scheduler will simply skip it and not give it any CPU time. Until a thread reenters the runnable state, it won’t perform any operations.</p>
</li>
<li>
<p><strong>Dead</strong>: A thread in the dead or terminated state is no longer schedulable and will not receive any CPU time. Its task is completed, and it is no longer runnable. One way for a task to die is by returning from its run( ) method, but a task’s thread can also be interrupted, as you’ll see shortly.</p>
</li>
</ol>
<h2 id="basic-threading"><a class="markdownIt-Anchor" href="#basic-threading"></a> Basic Threading</h2>
<h3 id="how-to-run-multiple-threads"><a class="markdownIt-Anchor" href="#how-to-run-multiple-threads"></a> How to run multiple threads</h3>
<h4 id="thread-and-runnable"><a class="markdownIt-Anchor" href="#thread-and-runnable"></a> Thread and Runnable</h4>
<p>A thread drives a <strong>task</strong>, so you need a way to describe that task. This is provided by the <strong>Runnable</strong> interface. To define a task, simply implement <strong>Runnable</strong> and write a <code>run( )</code> method to make the task do your bidding.</p>
<p>The traditional way to turn a Runnable object into a working task is to hand it to a <strong>Thread</strong> constructor. <code>Thread</code> is a low-level representation of thread.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> SomeRunnable());</span><br><span class="line">t.start() <span class="comment">// start a new thread</span></span><br></pre></td></tr></table></figure>
<h4 id="executors"><a class="markdownIt-Anchor" href="#executors"></a> Executors</h4>
<p><code>java.util.concurrent.Executors</code> simplify concurrent programming by managing <strong>Thread</strong> objects for you. <strong>Executors</strong> provide a layer of indirection between a client and the execution of a task; instead of a client executing a task directly, an <strong>intermediate</strong> object executes the task. Executors allow you to manage the execution of asynchronous tasks without having to explicitly manage the lifecycle of threads. Executors are the preferred method for starting tasks.</p>
<p>A <strong>Runnable</strong> object knows how to run a specific task, it exposes a single method to be executed. An <strong>ExecutorService</strong> (an Executor with a service lifecycle—e.g., shutdown) knows how to build the appropriate context to execute Runnable objects.</p>
<p>You can use <code>Executors.newCachedThreadPool()</code>, <code>Executors.newFixedThreadPool()</code>  or <code>Executors.newSingleThreadPool()</code> to create an <code>ExecutorService</code>.</p>
<ul>
<li>A <code>CachedThreadPool</code> will generally create as many threads as it needs during the execution of a program and then will stop creating new threads as it recycles the old ones, so it’s a reasonable first choice as an Executor.</li>
<li>With the <code>FixedThreadPool</code>, you do expensive thread allocation once, up front, and you thus limit the number of threads. This saves time because you aren’t constantly paying for thread creation overhead for every single task. Also, in an event-driven system, event handlers that require threads can be serviced as quickly as you want by simply fetching threads from the pool.</li>
<li>A <code>SingleThreadExecutor</code> is like a <code>FixedThreadPool</code> with a size of one thread. This is useful for anything you want to run in another thread continually (a long-lived task), such as a task that listens to incoming socket connections. It is also handy for short tasks that you want to run in a thread— for example, small tasks that update a local or remote log, or for an event-dispatching thread. It also offers an important concurrency guarantee that the others do not—<strong>no two tasks will be called concurrently</strong>. This changes the locking requirements for the tasks</li>
<li>Only if <code>CachedThreadPool</code> approach causes problems do you need to switch to a <code>FixedThreadPool</code>.</li>
</ul>
<h3 id="producing-return-values-from-tasks-using-callable"><a class="markdownIt-Anchor" href="#producing-return-values-from-tasks-using-callable"></a> Producing return values from tasks using <code>Callable</code></h3>
<p>A <strong>Runnable</strong> is a separate task that performs work, but it doesn’t return a value. If you want the task to produce a value when it’s done, you can implement the <strong>Callable</strong> interface rather than the Runnable interface, and submit the task using <code>executorService.submit</code>. The <code>submit()</code> method produces a <strong>Future</strong> object. You can query the <strong>Future</strong> with <code>isDone( )</code> to see if it has completed. When the task is completed and has a result, you can call <code>get( )</code> to fetch the result. <code>get( )</code> will block until the result is ready. You can also call <code>get( )</code> with a timeout. When <code>get()</code> blocks the thread, other thread can still run.</p>
<h3 id="sleep"><a class="markdownIt-Anchor" href="#sleep"></a> Sleep</h3>
<p>To cease (block) the execution of that task for a given time, use <code>TimeUnit.SomeUnit.sleep(int)</code>, <code>SomeUnit</code> can be <code>MILLSECOND</code>, <code>SECOND</code> an so on.</p>
<p>It does not release the object lock.</p>
<h3 id="yielding"><a class="markdownIt-Anchor" href="#yielding"></a> Yielding</h3>
<p><code>Thread.yield</code>  is a suggestion to the thread scheduler (the part of the Java threading mechanism that moves the CPU from one thread to the next) that says, “I’ve done the important parts of my cycle and this would be a good time to switch to another task for a while.” It’s completely optional, and it does not guarantee that the thread gives its access of execution.</p>
<p>It does not release the object lock.</p>
<h3 id="daemon-threads"><a class="markdownIt-Anchor" href="#daemon-threads"></a> Daemon threads</h3>
<p>A “<strong>daemon</strong>” thread is intended to provide a general service in the background as long as the program is running, but is not part of the essence of the program. Thus, when all of the non-daemon threads complete, the program is terminated, killing all daemon threads in the process. Set to daemon using</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable());</span><br><span class="line">t.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure>
<h3 id="joining-a-thread"><a class="markdownIt-Anchor" href="#joining-a-thread"></a> Joining a thread</h3>
<p>One thread may call <code>join( )</code> on another thread to wait for the second thread to complete before proceeding. If a thread calls <code>t.join( )</code> on another thread <code>t</code>, then the calling thread is suspended until the target thread <code>t</code> finishes (when <code>t.isAlive( )</code> is false). You may also call <code>join( )</code> with a <strong>timeout</strong> argument so that if the target thread doesn’t finish in that period of time, the call to <code>join( )</code> returns anyway.</p>
<h3 id="catching-exceptions"><a class="markdownIt-Anchor" href="#catching-exceptions"></a> Catching exceptions</h3>
<p><code>Thread.UncaughtExceptionHandler</code> is a new interface in Java SE5; it allows you to attach an exception handler to each <code>Thread</code> object. You can handle exception in the handler.</p>
<h3 id="fork-join-framework"><a class="markdownIt-Anchor" href="#fork-join-framework"></a> Fork-Join Framework</h3>
<blockquote>
<p><a href="https://www.baeldung.com/java-fork-join" target="_blank" rel="noopener">https://www.baeldung.com/java-fork-join</a></p>
</blockquote>
<h4 id="work-stealing-algorithm"><a class="markdownIt-Anchor" href="#work-stealing-algorithm"></a> Work Stealing Algorithm</h4>
<p>By default, a worker thread gets tasks from the head of its own deque. When it is empty, the thread takes a task from the tail of the deque of another busy thread or from the global entry queue, since this is where the biggest pieces of work are likely to be located.</p>
<h4 id="forkjoinpool-instantiation"><a class="markdownIt-Anchor" href="#forkjoinpool-instantiation"></a> ForkJoinPool Instantiation</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ForkJoinPool commonPool = ForkJoinPool.commonPool();</span><br></pre></td></tr></table></figure>
<h4 id="define-tasks"><a class="markdownIt-Anchor" href="#define-tasks"></a> Define Tasks</h4>
<p>Extends from <code>RecursiveTask</code> or <code>RecursiveAction</code>.</p>
<h4 id="submit-tasks"><a class="markdownIt-Anchor" href="#submit-tasks"></a> Submit Tasks</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">forkJoinPool.execute(customRecursiveTask);</span><br><span class="line"><span class="keyword">int</span> result = customRecursiveTask.join();</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> result = forkJoinPool.invoke(customRecursiveTask);</span><br><span class="line">forkJoinPool.invokeAll(list);</span><br><span class="line"></span><br><span class="line">customRecursiveTaskFirst.fork();</span><br><span class="line">result = customRecursiveTaskLast.join();</span><br></pre></td></tr></table></figure>
<h2 id="sharing-resources"><a class="markdownIt-Anchor" href="#sharing-resources"></a> Sharing resources</h2>
<p>With concurrency, you now have the possibility of two or more tasks interfering with each other, accessing the same field at the same time.</p>
<p>Preventing this kind of collision is simply a matter of putting a lock on a resource when one task is using it. The first task that accesses a resource must lock it, and then the other tasks cannot access that resource until it is unlocked, at which time another task locks and uses it, and so on. To solve the problem of thread collision, virtually all concurrency schemes serialize access to shared resources. This means that only one task at a time is allowed to access the shared resource. This is ordinarily accomplished by putting a clause around a piece of code that only allows one task at a time to pass through that piece of code. Because this clause produces mutual exclusion, a common name for such a mechanism is mutex.</p>
<p><strong>Critical sections</strong>: Sometimes, you only want to prevent multiple thread access to part of the code inside a method instead of the entire method. The section of code you want to isolate this way is called a critical section.</p>
<h3 id="synchronized-method"><a class="markdownIt-Anchor" href="#synchronized-method"></a> Synchronized method</h3>
<p>You can prevent collisions by declaring those methods <strong>synchronized</strong>, like <code>synchronized void f()</code>.</p>
<p>All <strong>objects</strong> automatically contain a <strong>single lock</strong> (also referred to as a monitor). The single lock that is <strong>shared by all the synchronized methods</strong> of a particular object. When you call any synchronized method, that object is locked and no other synchronized method of that object can be called until the first one finishes and releases the lock. Note that it’s especially important to make fields private when working with concurrency. Every method that accesses a critical shared resource must be synchronized or it won’t work right. And you should ensure every methods are locked using the same monitor lock.</p>
<p>There’s also a <strong>single lock per class</strong> (as part of the Class object for the class), so that synchronized static methods can lock each other out from simultaneous access of static data on a class-wide basis.</p>
<p><strong>The lock is acquired by a task (thread), so once a task acquires the lock, it can access as many as methods that belongs to the lock.</strong></p>
<h3 id="javautilconcurrentlocks"><a class="markdownIt-Anchor" href="#javautilconcurrentlocks"></a> <code>java.util.concurrent.locks</code></h3>
<p><code>java.util.concurrent</code> library also contains an explicit mutex mechanism defined in <code>java.util.concurrent.locks</code>. The Lock object must be explicitly created, locked and unlocked; thus, it produces less elegant code than the built-in form. However, it is more flexible for solving certain types of problems. Right after the call to <code>lock( )</code>, you must place a try-finally statement with <code>unlock( )</code> in the finally clause—this is the only way to guarantee that the lock is always released. Note that the return statement must occur inside the try clause to ensure that the <code>unlock( )</code> doesn’t happen too early and expose the data to a second task.</p>
<p>with the lock object, you can try and fail to acquire a lock using <code>lock.tryLock()</code>, or try to acquire a lock for a certain amount of time and then give up using <code>lock.tryLock(2, TimeUnit.SECONDS)</code>.</p>
<h3 id="condition-vs-wait-and-notify"><a class="markdownIt-Anchor" href="#condition-vs-wait-and-notify"></a> Condition vs Wait and Notify</h3>
<p>Multiple conditions can share a lock.</p>
<p>There are many <strong>advantages</strong> like mentioned above about <strong>Condition Interface</strong> some important are as follows:</p>
<p><strong>Condition interface</strong> comes with <strong>Two</strong> extra <strong>methods</strong> that are:</p>
<p><strong>1)<code>boolean awaitUntil(Date deadline)throws InterruptedException</code> :</strong> Causes the current thread to wait until it is signalled or interrupted, or the specified deadline elapses.</p>
<p><strong>2) <code>awaitUninterruptibly()</code> :</strong> Causes the current thread to wait until it is signaled.</p>
<h3 id="atomicity-and-volatility"><a class="markdownIt-Anchor" href="#atomicity-and-volatility"></a> Atomicity and volatility</h3>
<p>An atomic operation is one that cannot be interrupted by the thread scheduler; if the operation begins, then it will run to completion before the possibility of a context switch. Relying on atomicity is tricky and dangerous—<u>you should only try to use atomicity instead of synchronization if you are a concurrency expert, or you have help from such an expert</u>.  If you can write a high-performance JVM for a modern microprocessor, then you are qualified to think about whether you can avoid synchronizing.</p>
<p>Reading and writing <strong>primitive</strong> variables other than long and double is guaranteed to go to and from memory as <strong>indivisible (atomic)</strong> operations.</p>
<p>The <strong>volatile</strong> keyword also ensures visibility across the application. If you declare a field to be volatile, this means that <u>as soon as a write occurs for that field, all reads will see the change (in the next read)</u>. This is true even if local caches are involved—<strong>volatile</strong> fields are immediately <u>written through to main memory, and reads occur from main memory</u>. The <strong>volatile</strong> also forbidden reorder operations of the variable.</p>
<p>It’s important to understand that <u>atomicity and volatility are distinct concepts</u>. An <strong>atomic</strong> operation on a <strong>non-volatile</strong> field will not necessarily be flushed to main memory, and <u>so another task that reads that field will not necessarily see the new value</u> If multiple tasks are accessing a field, that field should be volatile; otherwise, the field should only be accessed via synchronization. <u><strong>Synchronization</strong> also causes flushing to main memory</u>, so if a field is completely guarded by synchronized methods or blocks, it is not necessary to make it volatile.</p>
<p>Volatile 变量具有 <code>synchronized</code> 的可见性特性，但是不具备原子特性。这就是说线程能够自动发现 volatile 变量的最新值。Volatile 变量可用于提供线程安全，但是只能应用于非常有限的一组用例：多个变量之间或者某个变量的当前值与修改后值之间没有约束。</p>
<p>要使 volatile 变量提供理想的线程安全，必须同时满足下面两个条件：</p>
<ul>
<li>对变量的写操作不依赖于当前值。</li>
<li>该变量没有包含在具有其他变量的不变式中。</li>
</ul>
<blockquote>
<p><a href="http://www.techug.com/post/java-volatile-keyword.html" target="_blank" rel="noopener">http://www.techug.com/post/java-volatile-keyword.html</a></p>
</blockquote>
<h3 id="synchronized-block"><a class="markdownIt-Anchor" href="#synchronized-block"></a> Synchronized block</h3>
<p>Critical section created using the <strong>synchronized</strong> keyword. This is also called a <strong>synchronized block</strong>.</p>
<h3 id="thread-local-storage"><a class="markdownIt-Anchor" href="#thread-local-storage"></a> Thread local storage</h3>
<p>A second way to prevent tasks from colliding over shared resources is to <strong>eliminate the sharing of variables</strong>. Thread local storage is a mechanism that <u>automatically creates different storage for the same variable, for each different thread that uses an object</u>. The creation and management of thread local storage is taken care of by the <code>java.lang.ThreadLocal</code> class.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;Integer&gt; t = ThreadLocal.withInitial(()-&gt;<span class="number">10</span>);</span><br></pre></td></tr></table></figure>
<h2 id="terminating-tasks"><a class="markdownIt-Anchor" href="#terminating-tasks"></a> Terminating tasks</h2>
<h3 id="check-state"><a class="markdownIt-Anchor" href="#check-state"></a> Check state</h3>
<p><code>cancel( )</code> and <code>isCanceled( )</code> methods are placed in a class that is seen by all tasks. The tasks check <code>isCanceled( )</code> to determine when to terminate themselves. But remember to add synchronized keyword if you are not confident.</p>
<h3 id="becoming-blocked"><a class="markdownIt-Anchor" href="#becoming-blocked"></a> Becoming blocked</h3>
<p>A task can become blocked for the following reasons:</p>
<ul>
<li>You’ve put the task to sleep by calling <code>sleep(milliseconds)</code>, in which case it will not be run for the specified time.</li>
<li>You’ve suspended the execution of the thread with <code>wait( )</code>. It will not become runnable again until the thread gets the <code>notify( )</code> or <code>notifyAll( )</code> message (or the equivalent <code>signal( )</code> or <code>signalAll( )</code> for the Java SE5 java.util.concurrent library tools).</li>
<li>The task is waiting for some <strong>I/O</strong> to complete.</li>
<li>The task is trying to call a <strong>synchronized</strong> method on another object, and that object’s lock is not available because it has already been acquired by another task.</li>
</ul>
<p>Sometimes you want to terminate a task that is in a blocked state. If you can’t wait for it to get to a point in the code where it can check a state value and decide to terminate on its own, you have to force the task out of its blocked state.</p>
<h3 id="interruption"><a class="markdownIt-Anchor" href="#interruption"></a> Interruption</h3>
<p>As you might imagine, it’s much <strong>messier</strong> to break out of the middle of a <code>Runnable.run( )</code> method than it is to wait for that method to get to a test of a “cancel” flag, or to some other place where the programmer is ready to leave the method. When you break out of a blocked task, you might need to <strong>clean up resources</strong>. Because of this, breaking out of the middle of a task’s <code>run( )</code> is more like throwing an exception than anything else, so in Java threads, exceptions are used for this kind of abort.</p>
<p><strong>Thread</strong> class contains the <code>interrupt( )</code> method. This sets the interrupted status for that thread. A thread with its interrupted status set will throw an <code>InterruptedException</code> if it is already <strong>blocked</strong> or if it <strong>attempts a blocking operation</strong>. The interrupted status will be <strong>reset</strong> when the exception is <strong>thrown</strong> or if the task calls <code>Thread.interrupted( )</code>.</p>
<p>If you call <code>shutdownNow( )</code> on an <strong>Executor</strong>, it will send an <code>interrupt( )</code> call to each of the threads it has started. To only interrupt a single task. If you’re using <strong>Executors</strong>, you can hold on to the context of a task when you start it by calling <code>submit( )</code> instead of <code>execute( )</code>. You are holding <code>Future&lt;?&gt;</code> that can call <code>cancel()</code> on it and interrupt a particular task.</p>
<p>You cannot interrupt a task that is trying to acquire a synchronized lock or one that is trying to perform I/O.</p>
<ul>
<li>I/O: One way is to close the <code>InputStream</code> directly, or use <code>nio</code> package.</li>
<li>synchronized lock: use <code>ReentrantLock.lockInterruptibly()</code></li>
</ul>
<h3 id="checking-for-an-interrupt"><a class="markdownIt-Anchor" href="#checking-for-an-interrupt"></a> Checking for an interrupt</h3>
<p>Totally no idea what does it talks</p>
<h2 id="cooperation-between-tasks"><a class="markdownIt-Anchor" href="#cooperation-between-tasks"></a> Cooperation between tasks</h2>
<p>When you use threads to run more than one task at a time, you can keep one task from interfering with another task’s resources by using a lock (mutex) to synchronize the behavior of the two tasks. That is, if two tasks are stepping on each other over a shared resource (usually memory), you use a mutex to allow only one task at a time to access that resource.</p>
<p>With that problem solved, the next step is to learn how to make tasks cooperate with each other, so that multiple tasks can work together to solve a problem. Now the issue is not about interfering with one another, but rather about working in unison, since portions of such problems must be solved before other portions can be solved.</p>
<p>The key issue when tasks are cooperating is <strong>handshaking</strong> between those tasks. To accomplish this handshaking, we use the same foundation: the mutex, which in this case guarantees that only one task can respond to a signal. This eliminates any possible race conditions. On top of the mutex, we add a way for a task to suspend itself until some external state changes, indicating that it’s time for that task to move forward.</p>
<h3 id="wait-and-notifyall"><a class="markdownIt-Anchor" href="#wait-and-notifyall"></a> <code>wait()</code> and <code>notifyAll()</code></h3>
<p><code>wait()</code> allows you to wait for a change in some condition that is outside the control of the forces in the current method. Often, this condition will be changed by another task. <code>wait()</code> suspends the task while waiting for the world to change, and only when a <code>notify( )</code> or <code>notifyAll( )</code> occurs—suggesting that something of interest may have happened—does the task wake up and check for changes.</p>
<p>When a task enters a call to <code>wait( )</code> inside a method, that thread’s execution is suspended, and the lock on that object is released.</p>
<p>In fact, the only place you can call <code>wait( )</code> <code>notify( )</code> or <code>notifyAll( )</code> is within a <strong>synchronized</strong> method or <strong>block</strong> (<code>sleep( )</code> can be called within non-synchronized methods since it doesn’t manipulate the lock).</p>
<p>Right way to prevent race condition over a <code>condition</code> variable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//T1:</span></span><br><span class="line"><span class="keyword">synchronized</span>(sharedMonitor) &#123;</span><br><span class="line">    <span class="comment">//&lt;setup condition for T2 that may prevent T2 to execute&gt;</span></span><br><span class="line">    sharedMonitor.notify();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//T2:</span></span><br><span class="line"><span class="keyword">synchronized</span>(sharedMonitor) &#123;</span><br><span class="line">    <span class="keyword">while</span>(conditionNotMet)&#123;</span><br><span class="line">        sharedMonitor.wait();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Always use the following idiom for a <code>wait()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(conditionNotMet)&#123;</span><br><span class="line">    wait();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="死锁活锁和饥饿"><a class="markdownIt-Anchor" href="#死锁活锁和饥饿"></a> 死锁，活锁和饥饿</h3>
<p><strong>什么是死锁</strong></p>
<p>死锁：是指<strong>两个或两个以上的进程（或线程）<strong>在执行过程中，因</strong>争夺资源而造成的一种互相等待的现象</strong>，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程。</p>
<p><strong>死锁发生的条件</strong></p>
<ul>
<li>
<p>互斥条件：线程对资源的访问是排他性的，如果一个线程对占用了某资源，那么<strong>其他线程必须处于等待状态</strong>，直到资源被释放。</p>
</li>
<li>
<p>请求和保持条件：线程T1<strong>至少已经保持了一个资源R1占用</strong>,但<strong>又提出对另一个资源R2请求</strong>，而此时，资源R2被其他线程T2占用，于是该线程T1也必须等待，但<strong>又对自己保持的资源R1不释放</strong>。</p>
</li>
<li>
<p>不剥夺条件：线程已获得的资源，<strong>在未使用完之前，不能被其他线程剥夺，只能在使用完以后由自己释放</strong>。</p>
</li>
<li>
<p>环路等待条件：在死锁发生时，<strong>必然存在一个“进程-资源环形链”</strong>，即：{p0,p1,p2,…pn},进程p0（或线程）等待p1占用的资源，p1等待p2占用的资源，pn等待p0占用的资源。（最直观的理解是，p0等待p1占用的资源，而p1而在等待p0占用的资源，于是两个进程就相互等待）</p>
</li>
</ul>
<p><strong>什么是活锁</strong></p>
<p>活锁：是指线程1可以使用资源，但它很礼貌，让其他线程先使用资源，线程2也可以使用资源，但它很绅士，也让其他线程先使用资源。这样你让我，我让你，最后两个线程都无法使用资源。</p>
<h3 id="producers-and-consumers"><a class="markdownIt-Anchor" href="#producers-and-consumers"></a> Producers and Consumers*</h3>
<p>performance tuning</p>
<p>Synchronize access to shared mutable data<br>
Avoid excessive synchronization<br>
Prefer executors, tasks and streams to threads<br>
Prefer concurrency utilities to <code>wait</code> and <code>notify</code><br>
Document thread safety<br>
Use lazy initialization judiciously<br>
Don’t depend on the thread scheduler</p>
<p><strong>Synchronizing constructors</strong> doesn’t make sense, because only the thread that creates an object should have access to it while it is being constructed.</p>
<h2 id="coroutine"><a class="markdownIt-Anchor" href="#coroutine"></a> Coroutine</h2>
<p>现在的操作系统都是支持多任务的，多任务可通过多进程或多线程的方式去实现，进程和线程的对比就不在这里说了，在多任务的调度上操作系统采取抢占式 和协作式两种方式，抢占式是指操作系统给每个任务一定的执行时间片，在到达这个时间片后如任务仍然未释放对CPU的占用，那么操作系统将强制释放，这是目 前多数操作系统采取的方式；协作式是指操作系统按照任务的顺序来分配CPU，每个任务执行过程中除非其主动释放，否则将一直占据CPU，这种方式非常值得 注意的是一旦有任务占据CPU不放，会导致其他任务”饿死”的现象，因此操作系统确实不太适合采用这种方式。</p>
<p>说完操作系统多任务的调度方式后，来看看通常程序是如何实现支持高并发的，一种就是典型的基于操作系统提供的多进程或多线程机制，每个任务占据一个 进程或一个线程，当任务中有IO等待等动作时，则将进程或线程放入待调度队列中，这种方式是目前大多数程序采取的方式，这种方式的坏处在于如想支持高的并 发量，就不得不创建很多的进程或线程，而进程和线程都是要消耗不少系统资源的，另外一方面，进程或线程创建太多后，操作系统需要花费很多的时间在进程或线 程的切换上，切换动作需要做状态保持和恢复，这也会消耗掉很多的系统资源；另外一种方式则是每个任务不完全占据一个进程或线程，当任务执行过程中需要进行 IO等待等动作时，任务则将其所占据的进程或线程释放，以便其他任务使用这个进程或线程，这种方式的好处在于可以减少所需要的原生的进程或线程数，并且由 于操作系统不需要做进程或线程的切换，而是自行来实现任务的切换，其成本会较操作系统切换低，这种方式也就是本文的重点，Coroutine方式，又称协 程方式，这种方式在目前的大多数语言中都有支持。</p>
<p>各种语言在实现Coroutine方式的支持时，多数都采用了Actor Model来实现，Actor Model简单来说就是每个任务就是一个Actor，Actor之间通过消息传递的方式来进行交互，而不采用共享的方式，Actor可以看做是一个轻量级 的进程或线程</p>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/language/" rel="tag"># language</a>
          
            <a href="/tags/java/" rel="tag"># java</a>
          
            <a href="/tags/book/" rel="tag"># book</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/MySQL-Crash-Course-Notes/" rel="next" title="MySQL 必知必会笔记 (TODO)">
                <i class="fa fa-chevron-left"></i> MySQL 必知必会笔记 (TODO)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/LeetCode-Part-1/" rel="prev" title="LeetCode Problems (Part 1)">
                LeetCode Problems (Part 1) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">黄泽强（Zeqiang Huang)</p>
              <p class="site-description motion-element" itemprop="description">笔记/科研</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">43</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">34</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/hzqjyyx" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          
          <div id="toc-div" class="post-toc" style="display:block">
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#basic-idea"><span class="nav-number">1.</span> <span class="nav-text"> Basic Idea</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#general-understanding"><span class="nav-number">2.</span> <span class="nav-text"> General Understanding</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#data-type"><span class="nav-number">2.1.</span> <span class="nav-text"> Data Type</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#primitive"><span class="nav-number">2.1.1.</span> <span class="nav-text"> Primitive</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#cast"><span class="nav-number">2.1.1.1.</span> <span class="nav-text"> Cast</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefer-primitive-types-to-boxed-primitives"><span class="nav-number">2.1.2.</span> <span class="nav-text"> Prefer primitive types to boxed primitives</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#high-precision-numbers"><span class="nav-number">2.1.3.</span> <span class="nav-text"> High-precision numbers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#avoid-float-and-double-if-exact-answers-are-required"><span class="nav-number">2.1.4.</span> <span class="nav-text"> Avoid float and double if exact answers are required</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#control-flow"><span class="nav-number">2.2.</span> <span class="nav-text"> Control Flow</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#iterate"><span class="nav-number">2.2.1.</span> <span class="nav-text"> Iterate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefer-for-each-loops-to-traditional-for-loop"><span class="nav-number">2.2.2.</span> <span class="nav-text"> Prefer for-each loops to traditional for loop</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#objects-creation"><span class="nav-number">2.3.</span> <span class="nav-text"> Objects creation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#consider-static-factory-methods"><span class="nav-number">2.3.1.</span> <span class="nav-text"> Consider static factory methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#consider-a-builder"><span class="nav-number">2.3.2.</span> <span class="nav-text"> Consider a builder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#consider-singleton"><span class="nav-number">2.3.3.</span> <span class="nav-text"> Consider singleton</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#enforce-non-insatiability-with-private-constructor"><span class="nav-number">2.3.4.</span> <span class="nav-text"> Enforce non-insatiability with private constructor</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#apply-dependency-injection-when-flexibility-is-required-during-object-creation"><span class="nav-number">2.3.5.</span> <span class="nav-text"> Apply dependency injection when flexibility is required during object creation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#eliminate-obsolete-references"><span class="nav-number">2.3.6.</span> <span class="nav-text"> Eliminate obsolete references</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#avoid-creating-unnecessary-objects"><span class="nav-number">2.3.7.</span> <span class="nav-text"> Avoid creating unnecessary objects</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#objects-common-contraction"><span class="nav-number">2.4.</span> <span class="nav-text"> Objects common contraction</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#override-equals"><span class="nav-number">2.4.1.</span> <span class="nav-text"> Override equals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#override-hashcode-when-you-override-equals"><span class="nav-number">2.4.2.</span> <span class="nav-text"> Override hashCode when you override equals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#override-tostring"><span class="nav-number">2.4.3.</span> <span class="nav-text"> Override toString</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#override-clone-judiciously"><span class="nav-number">2.4.4.</span> <span class="nav-text"> Override clone judiciously</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#implement-comparable"><span class="nav-number">2.4.5.</span> <span class="nav-text"> Implement Comparable</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scope"><span class="nav-number">2.5.</span> <span class="nav-text"> Scope</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#minimize-the-scope-of-local-variables"><span class="nav-number">2.5.1.</span> <span class="nav-text"> Minimize the scope of local variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#minimize-the-accessibility-of-classes"><span class="nav-number">2.5.2.</span> <span class="nav-text"> Minimize the accessibility of classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#in-public-classes-use-accessor"><span class="nav-number">2.5.3.</span> <span class="nav-text"> In public classes, use accessor</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#strings"><span class="nav-number">2.6.</span> <span class="nav-text"> Strings</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#format"><span class="nav-number">2.6.1.</span> <span class="nav-text"> Format</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#avoid-string-where-other-types-are-more-appropriate"><span class="nav-number">2.6.2.</span> <span class="nav-text"> Avoid String where other types are more appropriate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#beware-the-performance-of-string-concatenation"><span class="nav-number">2.6.3.</span> <span class="nav-text"> Beware the performance of string concatenation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#others"><span class="nav-number">2.7.</span> <span class="nav-text"> Others</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#use-native-methods-judiciously"><span class="nav-number">2.7.1.</span> <span class="nav-text"> Use native methods judiciously</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#optimize-judiciously"><span class="nav-number">2.7.2.</span> <span class="nav-text"> Optimize judiciously</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#adhere-to-generally-accepted-naming-conventions"><span class="nav-number">2.7.3.</span> <span class="nav-text"> Adhere to generally accepted naming conventions</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#class"><span class="nav-number">3.</span> <span class="nav-text"> Class</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#basic"><span class="nav-number">3.1.</span> <span class="nav-text"> Basic</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#method-overloading"><span class="nav-number">3.1.1.</span> <span class="nav-text"> Method overloading</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#initialization"><span class="nav-number">3.2.</span> <span class="nav-text"> Initialization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#initialization-order"><span class="nav-number">3.2.1.</span> <span class="nav-text"> Initialization order</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#when-does-initialization-occurs"><span class="nav-number">3.2.2.</span> <span class="nav-text"> When does initialization occurs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clean"><span class="nav-number">3.3.</span> <span class="nav-text"> Clean</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#finalizers"><span class="nav-number">3.3.1.</span> <span class="nav-text"> Finalizers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#the-termination-condition"><span class="nav-number">3.3.1.1.</span> <span class="nav-text"> The termination condition</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cleaners"><span class="nav-number">3.3.2.</span> <span class="nav-text"> Cleaners</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#avoid-finalizers-and-cleaners"><span class="nav-number">3.3.3.</span> <span class="nav-text"> Avoid finalizers and cleaners</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#inheritance"><span class="nav-number">3.4.</span> <span class="nav-text"> Inheritance</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#polymorphism"><span class="nav-number">3.5.</span> <span class="nav-text"> Polymorphism</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#method-call-binding"><span class="nav-number">3.5.1.</span> <span class="nav-text"> Method-call binding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pitfall"><span class="nav-number">3.5.2.</span> <span class="nav-text"> Pitfall</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#inner-class"><span class="nav-number">3.6.</span> <span class="nav-text"> Inner Class</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#anonymous-inner-classes"><span class="nav-number">3.6.1.</span> <span class="nav-text"> Anonymous inner classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nested-classes"><span class="nav-number">3.6.2.</span> <span class="nav-text"> Nested classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#why-inner-classes"><span class="nav-number">3.6.3.</span> <span class="nav-text"> Why inner classes</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#interface"><span class="nav-number">4.</span> <span class="nav-text"> Interface</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#complete-decoupling"><span class="nav-number">4.1.</span> <span class="nav-text"> Complete decoupling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#multiple-inheritance-in-java"><span class="nav-number">4.2.</span> <span class="nav-text"> Multiple inheritance in Java</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#array-and-container"><span class="nav-number">5.</span> <span class="nav-text"> Array and Container</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#array"><span class="nav-number">5.1.</span> <span class="nav-text"> Array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#container"><span class="nav-number">5.2.</span> <span class="nav-text"> Container</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#list"><span class="nav-number">5.2.1.</span> <span class="nav-text"> List</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#arraylist"><span class="nav-number">5.2.1.1.</span> <span class="nav-text"> ArrayList</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#arraylist-source-code-analysis"><span class="nav-number">5.2.1.2.</span> <span class="nav-text"> ArrayList Source Code Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#init"><span class="nav-number">5.2.1.2.1.</span> <span class="nav-text"> init</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add"><span class="nav-number">5.2.1.2.2.</span> <span class="nav-text"> add</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#modcount"><span class="nav-number">5.2.1.2.3.</span> <span class="nav-text"> modCount</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#linkedlist"><span class="nav-number">5.2.1.3.</span> <span class="nav-text"> LinkedList</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#linkedlist-source-code"><span class="nav-number">5.2.1.4.</span> <span class="nav-text"> LinkedList source code</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#add-2"><span class="nav-number">5.2.1.4.1.</span> <span class="nav-text"> add</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#get"><span class="nav-number">5.2.1.4.2.</span> <span class="nav-text"> get</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#provided-by-arrays-and-collections"><span class="nav-number">5.2.1.5.</span> <span class="nav-text"> Provided by Arrays and  Collections</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iterator-listiterator-and-spliterator"><span class="nav-number">5.2.1.6.</span> <span class="nav-text"> Iterator, ListIterator and Spliterator</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#set"><span class="nav-number">5.2.2.</span> <span class="nav-text"> Set</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sortedset"><span class="nav-number">5.2.2.1.</span> <span class="nav-text"> SortedSet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#queue"><span class="nav-number">5.2.3.</span> <span class="nav-text"> Queue</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#priorityqueue"><span class="nav-number">5.2.3.1.</span> <span class="nav-text"> PriorityQueue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#deque"><span class="nav-number">5.2.3.2.</span> <span class="nav-text"> Deque</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#blockingqueue"><span class="nav-number">5.2.3.3.</span> <span class="nav-text"> BlockingQueue</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#map"><span class="nav-number">5.3.</span> <span class="nav-text"> Map</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#holding-references"><span class="nav-number">5.3.1.</span> <span class="nav-text"> Holding references</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#weakhashmap"><span class="nav-number">5.3.2.</span> <span class="nav-text"> WeakHashMap</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#exception"><span class="nav-number">6.</span> <span class="nav-text"> Exception</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#concepts"><span class="nav-number">6.1.</span> <span class="nav-text"> Concepts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#throwable-error-and-exception"><span class="nav-number">6.2.</span> <span class="nav-text"> Throwable, Error and Exception</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cleanup-with-finally"><span class="nav-number">6.3.</span> <span class="nav-text"> Cleanup with finally</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#best-practice"><span class="nav-number">6.4.</span> <span class="nav-text"> Best practice</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#prefer-try-with-resources-to-try-finally"><span class="nav-number">6.4.1.</span> <span class="nav-text"> Prefer try-with-resources to try-finally</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#enum-and-annotation"><span class="nav-number">7.</span> <span class="nav-text"> Enum and Annotation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#enum"><span class="nav-number">7.1.</span> <span class="nav-text"> Enum</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#use-enum-instead-of-int-constants"><span class="nav-number">7.1.1.</span> <span class="nav-text"> Use Enum instead of int constants</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-instance-fields-instead-of-ordinals"><span class="nav-number">7.1.2.</span> <span class="nav-text"> Use instance fields instead of ordinals</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-enumset-instead-of-bit-fields"><span class="nav-number">7.1.3.</span> <span class="nav-text"> Use EnumSet instead of bit fields</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-enummap-instead-of-ordinal-indexing"><span class="nav-number">7.1.4.</span> <span class="nav-text"> Use EnumMap instead of ordinal indexing</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#emulate-extensible-enums-with-interfaces"><span class="nav-number">7.1.5.</span> <span class="nav-text"> Emulate extensible enums with interfaces</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#annotations"><span class="nav-number">7.2.</span> <span class="nav-text"> Annotations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#define-annotation"><span class="nav-number">7.2.1.</span> <span class="nav-text"> Define Annotation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefer-annotations-to-naming-patterns"><span class="nav-number">7.2.2.</span> <span class="nav-text"> Prefer annotations to naming patterns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#consistently-use-the-override-annotation"><span class="nav-number">7.2.3.</span> <span class="nav-text"> Consistently use the Override annotation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-marker-interface-to-define-types"><span class="nav-number">7.2.4.</span> <span class="nav-text"> Use marker interface to define types</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#generics-and-types"><span class="nav-number">8.</span> <span class="nav-text"> Generics and Types</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#types"><span class="nav-number">8.1.</span> <span class="nav-text"> Types</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#class-object"><span class="nav-number">8.1.1.</span> <span class="nav-text"> Class object</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dynamic-proxies"><span class="nav-number">8.1.2.</span> <span class="nav-text"> Dynamic proxies</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#generics"><span class="nav-number">8.2.</span> <span class="nav-text"> Generics</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#io"><span class="nav-number">9.</span> <span class="nav-text"> I/O</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#inputstream-and-outputstram"><span class="nav-number">9.1.</span> <span class="nav-text"> InputStream and OutputStram</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#types-of-inputstream"><span class="nav-number">9.1.1.</span> <span class="nav-text"> Types of InputStream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#types-of-outputstream"><span class="nav-number">9.1.2.</span> <span class="nav-text"> Types of OutputStream</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#adding-attributes-and-useful-interfaces"><span class="nav-number">9.2.</span> <span class="nav-text"> Adding attributes and useful interfaces</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reading-from-inputstream-with-filterlnputstream"><span class="nav-number">9.2.1.</span> <span class="nav-text"> Reading from InputStream with FilterlnputStream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#writing-to-an-outputstream-with-filteroutputstream"><span class="nav-number">9.2.2.</span> <span class="nav-text"> Writing to an OutputStream with FilterOutputStream</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#readers-and-writers"><span class="nav-number">9.3.</span> <span class="nav-text"> Readers and Writers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#new-io"><span class="nav-number">9.4.</span> <span class="nav-text"> New I/O</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#basic-usage"><span class="nav-number">9.4.1.</span> <span class="nav-text"> Basic usage</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#view-buffers"><span class="nav-number">9.4.2.</span> <span class="nav-text"> View buffers</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#typical-use-of-io-streams"><span class="nav-number">9.5.</span> <span class="nav-text"> Typical use of I/O streams</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#standard-io"><span class="nav-number">9.6.</span> <span class="nav-text"> Standard I/O</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#concurrency"><span class="nav-number">10.</span> <span class="nav-text"> Concurrency</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#thread-states"><span class="nav-number">10.1.</span> <span class="nav-text"> Thread states</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#basic-threading"><span class="nav-number">10.2.</span> <span class="nav-text"> Basic Threading</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#how-to-run-multiple-threads"><span class="nav-number">10.2.1.</span> <span class="nav-text"> How to run multiple threads</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#thread-and-runnable"><span class="nav-number">10.2.1.1.</span> <span class="nav-text"> Thread and Runnable</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#executors"><span class="nav-number">10.2.1.2.</span> <span class="nav-text"> Executors</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#producing-return-values-from-tasks-using-callable"><span class="nav-number">10.2.2.</span> <span class="nav-text"> Producing return values from tasks using Callable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sleep"><span class="nav-number">10.2.3.</span> <span class="nav-text"> Sleep</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yielding"><span class="nav-number">10.2.4.</span> <span class="nav-text"> Yielding</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#daemon-threads"><span class="nav-number">10.2.5.</span> <span class="nav-text"> Daemon threads</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#joining-a-thread"><span class="nav-number">10.2.6.</span> <span class="nav-text"> Joining a thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#catching-exceptions"><span class="nav-number">10.2.7.</span> <span class="nav-text"> Catching exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fork-join-framework"><span class="nav-number">10.2.8.</span> <span class="nav-text"> Fork-Join Framework</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#work-stealing-algorithm"><span class="nav-number">10.2.8.1.</span> <span class="nav-text"> Work Stealing Algorithm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#forkjoinpool-instantiation"><span class="nav-number">10.2.8.2.</span> <span class="nav-text"> ForkJoinPool Instantiation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#define-tasks"><span class="nav-number">10.2.8.3.</span> <span class="nav-text"> Define Tasks</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#submit-tasks"><span class="nav-number">10.2.8.4.</span> <span class="nav-text"> Submit Tasks</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sharing-resources"><span class="nav-number">10.3.</span> <span class="nav-text"> Sharing resources</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized-method"><span class="nav-number">10.3.1.</span> <span class="nav-text"> Synchronized method</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#javautilconcurrentlocks"><span class="nav-number">10.3.2.</span> <span class="nav-text"> java.util.concurrent.locks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#condition-vs-wait-and-notify"><span class="nav-number">10.3.3.</span> <span class="nav-text"> Condition vs Wait and Notify</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#atomicity-and-volatility"><span class="nav-number">10.3.4.</span> <span class="nav-text"> Atomicity and volatility</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#synchronized-block"><span class="nav-number">10.3.5.</span> <span class="nav-text"> Synchronized block</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-local-storage"><span class="nav-number">10.3.6.</span> <span class="nav-text"> Thread local storage</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#terminating-tasks"><span class="nav-number">10.4.</span> <span class="nav-text"> Terminating tasks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#check-state"><span class="nav-number">10.4.1.</span> <span class="nav-text"> Check state</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#becoming-blocked"><span class="nav-number">10.4.2.</span> <span class="nav-text"> Becoming blocked</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#interruption"><span class="nav-number">10.4.3.</span> <span class="nav-text"> Interruption</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#checking-for-an-interrupt"><span class="nav-number">10.4.4.</span> <span class="nav-text"> Checking for an interrupt</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cooperation-between-tasks"><span class="nav-number">10.5.</span> <span class="nav-text"> Cooperation between tasks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#wait-and-notifyall"><span class="nav-number">10.5.1.</span> <span class="nav-text"> wait() and notifyAll()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#死锁活锁和饥饿"><span class="nav-number">10.5.2.</span> <span class="nav-text"> 死锁，活锁和饥饿</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#producers-and-consumers"><span class="nav-number">10.5.3.</span> <span class="nav-text"> Producers and Consumers*</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#coroutine"><span class="nav-number">10.6.</span> <span class="nav-text"> Coroutine</span></a></li></ol></li></ol></div>
            
          </div>

          
          
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">黄泽强（Zeqiang Huang)</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total"></span>
  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.4</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  

  
    <script id="dsq-count-scr" src="https://hzqjyyx.disqus.com/count.js" async></script>
  

  
    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'https://hzqjyyx.github.io/2018/09/Understanding-Java/';
        this.page.identifier = '2018/09/Understanding-Java/';
        this.page.title = 'Understanding Java';
      };
      function loadComments () {
        var d = document, s = d.createElement('script');
        s.src = 'https://hzqjyyx.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      }
      
        loadComments();
      
    </script>
  





	





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  

  


  
  

  

  

  

  

</body>
</html>
